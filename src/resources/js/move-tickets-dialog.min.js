var tribe_move_tickets=tribe_move_tickets||{};!function(t,e){function i(){u=t("#main"),h=t(".error"),m=t("#processing"),y=t("#back"),x=t("#next"),y.add(x).hide(),m.hide(),h.length||(x.show(),a())}function a(){n(),"move_tickets"===tribe_move_tickets_data.mode?(c(),s()):(t("#move-where").remove(),t("#choose-ticket-type").remove()),g=t(".stage"),r(),d(),o(g.first())}function o(t){k=t,b=k.attr("id"),g.hide(),k.show(),u.trigger("pre-activate-stage.tribe"),u.trigger("activate-"+b+".tribe")}function c(){function e(){var t=a.filter(":checked");return t.length?("this-post"===t.val()?(_(tribe_move_tickets_data.src_post_id),j=!0):(C=!1,j=!1),void p(x,i)):void l(x,i)}var i="move-where",a=t('input[name="move-where"]');u.on("activate-move-where.tribe",function(){v(y,i),e()}),a.change(e)}function n(){function e(){r.html('<option value="">'+tribe_move_tickets_data.loading_msg+"</option>");var e={action:"move_tickets_get_post_types",check:tribe_move_tickets_data.check};t.post(ajaxurl,e,function(t){if("undefined"!=typeof t.data&&"object"==typeof t.data.posts){r.html("");for(var e in t.data.posts)r.append('<option value="'+e+'">'+t.data.posts[e]+"</option>")}})}function i(){if(!f){f=!0,s.css("opacity",.6),l(x,v);var e={action:"move_tickets_get_post_choices",check:tribe_move_tickets_data.check,post_type:r.val(),search_terms:d.val(),ignore:tribe_move_tickets_data.src_post_id};t.post(ajaxurl,e,function(t){if("undefined"!=typeof t.data&&"object"==typeof t.data.posts){s.html("");var e=0;for(var i in t.data.posts){var a=parseInt(i,10),o=t.data.posts[i];e++,s.append('<label> <input type="radio" value="'+a+'" name="post-choice">'+o+"</label>")}e||s.append("<label>"+tribe_move_tickets_data.no_posts_found+"</label>"),f=!1,s.css("opacity",1)}})}}function a(){var t=s.find("input:checked");s.find(".selected").removeClass("selected"),t.length&&(_(t.val()),t.parent("label").addClass("selected"),p(x,v))}var c,n=t("#choose-event"),s=n.find(".select-single-container"),r=t("#post-type"),d=t("#search-terms"),v="choose-event",f=!1;u.on("activate-choose-event.tribe",function(){p(y,v),l(x,v),j&&"next"===w?o(k.next()):j&&o(g.first()),a()}),e(),i(),d.keyup(function(){clearTimeout(c),c=setTimeout(i,200)}),r.change(i),s.click(function(){f||a()})}function s(){function e(){var t=c.find("input:checked");c.find(".selected").removeClass("selected"),t.length&&(I=parseInt(t.val()),t.parent("label").addClass("selected"),p(x,i))}var i="choose-ticket-type",a=t("#choose-ticket-type"),c=a.find(".select-single-container");u.on("activate-choose-ticket-type.tribe",function(){p(y,i),l(x,i),C||o(g.first())}),u.on("destination-post-selected.tribe",function(){c.css("opacity",.6),l(x,i);var e={action:"move_tickets_get_ticket_types",check:tribe_move_tickets_data.check,post_id:C,provider:tribe_move_tickets_data.provider};t.post(ajaxurl,e,function(t){if("object"==typeof t.data.posts){c.html("");var e=0;for(var i in t.data.posts){var a=parseInt(i,10),o=t.data.posts[i];e++,c.append('<label> <input type="radio" value="'+a+'" name="post-choice">'+o+"</label>")}e||c.append("<label>"+tribe_move_tickets_data.no_ticket_types_found+"</label>"),c.css("opacity",1)}})}),c.click(e)}function r(){function e(t){w=t;var e=k[t](".stage");e.length?o(e):f()&&u.trigger("move-tickets-final-stage.tribe")}var i=x.html(),a=x.data("final-text");a=a?a:i,u.on("pre-activate-stage.tribe",function(){x.html(f()?a:i)}),y.add(x).click(function(){switch(t(this).attr("id")){case"back":e("prev");break;case"next":e("next")}})}function d(){function e(){if(C&&I){var e={action:"move_tickets",src_post_id:tribe_move_tickets_data.src_post_id,target_post_id:C,check:tribe_move_tickets_data.check,ticket_ids:tribe_move_tickets_data.ticket_ids,target_type_id:I};g.hide(),y.hide(),x.hide(),m.show(),t.post(ajaxurl,e,function(t){a(t)}).fail(o)}}function i(){if(C){var e={action:"move_ticket_type",src_post_id:tribe_move_tickets_data.src_post_id,ticket_type_id:tribe_move_tickets_data.ticket_type_id,target_post_id:C,check:tribe_move_tickets_data.check};g.hide(),y.hide(),x.hide(),m.show(),t.post(ajaxurl,e,function(t){a(t)}).fail(o)}}function a(t){if("undefined"==typeof t.data||"string"!=typeof t.data.message)return void o();if(m.html(t.data.message),"string"==typeof t.data.redirect_top){var e="number"==typeof t.data.redirect_top_delay?t.data.redirect_top_delay:2e3;setTimeout(function(){top.location=t.data.redirect_top},e)}}function o(){m.html(tribe_move_tickets_data.unexpected_failure)}u.on("move-tickets-final-stage.tribe",function(){switch(tribe_move_tickets_data.mode){case"move_tickets":e();break;case"ticket_type_only":i()}})}function _(t){t=parseInt(t,10),t>0&&C!==t&&(C=t,u.trigger("destination-post-selected.tribe"))}function p(t,e){e===b&&(t.removeProp("disabled").show().removeClass("disabled"),"next"===t.attr("id")&&f()&&t.addClass("button-primary"))}function l(t,e){e===b&&t.prop("disabled",!0).addClass("disabled").removeClass("button-primary")}function v(t,e){e===b&&t.hide()}function f(){return!k.next(".stage").length}var u,m,h,k,b,g,y,x,w,j,C,I;t(document).ready(i)}(jQuery,tribe_move_tickets);