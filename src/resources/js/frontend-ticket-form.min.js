var tribe_tickets_ticket_form={};!function(t,e){var i,a;e.init=function(){i=t(".tribe-events-tickets-tpp"),a=i.find(".quantity").find(".qty"),a.on("change",e.on_quantity_change)},e.on_quantity_change=function(){var i=t(this),a=e.get_matching_ticket_id(this);e.ticket_uses_global_stock(a)?e.global_stock_quantity_changed(i,a):e.normal_stock_quantity_changed(i,a);var c=i.val(),n=i.closest("form");c>0?n.find('td[data-product-id]:not([data-product-id="'+a+'"])').closest("tr").find("input, button").attr("disabled","disabled").closest("tr").addClass("tribe-tickets-purchase-disabled"):n.find("input, button").removeAttr("disabled").closest("tr").removeClass("tribe-tickets-purchase-disabled")},e.global_stock_quantity_changed=function(t,i){var a=t.val(),c=e.get_event_id(i),n=e.get_cap(i),o=e.get_global_stock(c),_=e.currently_requested_global_event_stock(c);_>o&&(a-=_-o),e.stock_mode_is_capped(i)&&a>n&&(a=n),0>=a&&(a=0),t.val(a),e.update_available_stock_counts(c)},e.normal_stock_quantity_changed=function(a,c){var n,o=a.val(),_=e.get_single_stock(c);t.isNumeric(_)&&-1!==_&&(o>_&&(o=_),a.val(o),n=_-o,i.find(".available-stock[data-product-id="+c+"]").html(n))},e.update_available_stock_counts=function(a){var c=e.get_tickets_of(a),n=e.get_global_stock(a)-e.currently_requested_global_event_stock(a);for(var o in c)if(c.hasOwnProperty(o)){n<0&&(n=0);var _=c[o];if("global"===_.mode&&i.find(".available-stock[data-product-id="+o+"]").html(n),"capped"===_.mode){var r=Math.min(n,_.cap),s=parseInt(t("[data-product-id="+o+"]").find("input").val(),10),d=_.cap-s;d<0?d=0:d>r&&(d=r),i.find(".available-stock[data-product-id="+o+"]").html(d)}}},e.get_matching_ticket_id=function(e){var i=t(e).closest("[data-product-id]");if(i.length)return i.data("product-id")},e.get_ticket_property=function(t,e){if("object"!=typeof tribe_tickets_stock_data)return!1;var i=tribe_tickets_stock_data.tickets[t];return"undefined"!=typeof tribe_tickets_stock_data.tickets[t]&&i[e]},e.get_tickets_of=function(t){if("object"!=typeof tribe_tickets_stock_data)return!1;var e=[];for(var i in tribe_tickets_stock_data.tickets){var a=tribe_tickets_stock_data.tickets[i];t===a.event_id&&(e[i]=a)}return e},e.currently_requested_global_event_stock=function(a){var c=0,n=(e.get_tickets_of(a),i.find(".available-stock"));return n.each(function(e,i){var a=t(i),n=a.data("productId"),o=["global","capped"],_=tribe_tickets_stock_data.tickets[n].mode;if(-1!==o.indexOf(_)){var r=a.parents("tr").eq(0).find(".qty"),s=parseInt(r.val(),10);c+=s}}),c},e.get_event_property=function(t,e){if("object"!=typeof tribe_tickets_stock_data)return!1;var i=tribe_tickets_stock_data.events[t];return"undefined"!==tribe_tickets_stock_data.events[t]&&i[e]},e.stock_mode_is_global=function(t){return"global"===e.get_mode(t)},e.stock_mode_is_capped=function(t){return"capped"===e.get_mode(t)},e.ticket_uses_global_stock=function(t){return e.stock_mode_is_capped(t)||e.stock_mode_is_global(t)},e.get_mode=function(t){return e.get_ticket_property(t,"mode")},e.get_event_id=function(t){return e.get_ticket_property(t,"event_id")},e.get_cap=function(t){return e.get_ticket_property(t,"cap")},e.get_global_stock=function(t){return e.get_event_property(t,"stock")},e.get_single_stock=function(t){return e.get_ticket_property(t,"stock")},t(function(){e.init()}),t(document).on("click",".button-events-list",function(t){t.preventDefault();var e=t.target.parentElement.action;window.location=e})}(jQuery,tribe_tickets_ticket_form);