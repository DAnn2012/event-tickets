"undefined"==typeof tribe&&(tribe={}),void 0===tribe.tickets&&(tribe.tickets={}),tribe.tickets.registration={},function(r,c){"use strict";c.hasChanges={},c.formClasses={woo:"tribe-block__tickets__item__attendee__fields__form--woo",edd:"tribe-block__tickets__item__attendee__fields__form--edd"},c.selector={container:".tribe-block__tickets__registration__event",fields:".tribe-block__tickets__item__attendee__fields",fieldsError:".tribe-block__tickets__item__attendee__fields__error",fieldsErrorRequired:".tribe-block__tickets__item__attendee__fields__error--required",fieldsErrorAjax:".tribe-block__tickets__item__attendee__fields__error--ajax",fieldsSuccess:".tribe-block__tickets__item__attendee__fields__success",loader:".tribe-block__tickets__item__attendee__fields__loader",form:".tribe-block__tickets__item__attendee__fields__form",toggler:".tribe-block__tickets__registration__toggle__handler",status:".tribe-block__tickets__registration__status",field:{text:".tribe-block__tickets__item__attendee__field__text",checkbox:".tribe-block__tickets__item__attendee__field__checkbox",select:".tribe-block__tickets__item__attendee__field__select",radio:".tribe-block__tickets__item__attendee__field__radio"},checkout:".tribe-block__tickets__registration__checkout",checkoutButton:".tribe-block__tickets__registration__checkout__submit"},0!==r(c.selector.container).length&&(r(c.selector.container).on("click",c.selector.toggler,function(e){e.preventDefault();var t=r(this);t.closest(c.selector.container).find(c.selector.fields).toggle(),t.toggleClass("open")}),c.validateEventAttendees=function(e){var t=!0;return e.find(".tribe-tickets-meta-required").each(function(){var e=r(this);0===(e.is(c.selector.field.radio)||e.is(c.selector.field.checkbox)?e.find("input:checked").length?"checked":"":e.is(c.selector.field.select)?e.find("select").val():e.find("input, textarea").val().trim()).length&&(t=!1)}),t},c.updateStatusToComplete=function(e){e.find(c.selector.status).removeClass("incomplete"),e.find(c.selector.status).find("i").removeClass("dashicons-edit"),e.find(c.selector.status).find("i").addClass("dashicons-yes")},c.updateStatusToIncomplete=function(e){e.find(c.selector.status).addClass("incomplete"),e.find(c.selector.status).find("i").addClass("dashicons-edit"),e.find(c.selector.status).find("i").removeClass("dashicons-yes")},c.handleTppSaveSubmission=function(e){var t=r(this),i=t.closest(c.selector.fields);i.find(c.selector.fieldsErrorRequired).hide(),c.validateEventAttendees(t)||(e.preventDefault(),i.find(c.selector.fieldsErrorRequired).show())},c.handleSaveSubmission=function(e){e.preventDefault();var t=r(this),i=t.closest(c.selector.fields),s=i.closest(c.selector.container);if(i.find(c.selector.fieldsErrorRequired).hide(),i.find(c.selector.fieldsErrorAjax).hide(),i.find(c.selector.fieldsSuccess).hide(),c.validateEventAttendees(t)){i.find(c.selector.loader).show();var o=s.data("event-id"),n=t.serializeArray();n.push({name:"event_id",value:o}),n.push({name:"action",value:"tribe-tickets-save-attendee-info"}),r.post(TribeTicketsPlus.ajaxurl,n,function(e){e.success?(c.updateStatusToComplete(s),c.hasChanges[o]=!1,i.find(c.selector.fieldsSuccess).show(),e.data.meta_up_to_date&&r(c.selector.checkoutButton).removeAttr("disabled")):i.find(c.selector.fieldsErrorAjax).show(),i.find(c.selector.loader).hide()})}else i.find(c.selector.fieldsErrorRequired).show(),c.updateStatusToIncomplete(s)},c.handleCheckoutSubmission=function(e){!Object.keys(c.hasChanges).reduce(function(e,t){return e||c.hasChanges[t]},!1)||confirm(tribe_l10n_datatables.registration_prompt)||e.preventDefault()},c.setHasChanges=function(e){return function(){c.hasChanges[e]=!0}},c.bindFormFields=function(e){var t=e.data("event-id");c.hasChanges[t]=!1,[e.find(c.selector.field.text),e.find(c.selector.field.checkbox),e.find(c.selector.field.radio),e.find(c.selector.field.select)].forEach(function(e){(e.is(c.selector.field.radio)||e.is(c.selector.field.checkbox)?e.find("input"):e.is(c.selector.field.select)?e.find("select"):e.find("input, textarea")).change(c.setHasChanges(t))})},c.bindCheckout=function(){r(c.selector.checkout).submit(c.handleCheckoutSubmission)},c.bindEvents=function(){c.bindCheckout()},c.initContainers=function(){r(c.selector.container).each(function(){var e=r(this);c.validateEventAttendees(e)?c.updateStatusToComplete(e):c.updateStatusToIncomplete(e);var t=e.find(c.selector.form);t.hasClass(c.formClasses.woo)||t.hasClass(c.formClasses.edd)?r(t).on("submit",c.handleSaveSubmission):r(t).on("submit",c.handleTppSaveSubmission),c.bindFormFields(e)})},c.initPage=function(){c.initContainers(),c.bindEvents()},c.init=function(){c.initPage()},c.init())}(jQuery,tribe.tickets.registration);