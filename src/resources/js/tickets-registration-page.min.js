"undefined"==typeof tribe&&(tribe={}),void 0===tribe.tickets&&(tribe.tickets={}),tribe.tickets.registration={},function(o,n){"use strict";n.hasChanges=!1,n.selector={container:".tribe-block__tickets__registration__event",fields:".tribe-block__tickets__item__attendee__fields",fieldsError:".tribe-block__tickets__item__attendee__fields__error",fieldsErrorRequired:".tribe-block__tickets__item__attendee__fields__error--required",fieldsErrorAjax:".tribe-block__tickets__item__attendee__fields__error--ajax",loader:".tribe-block__tickets__item__attendee__fields__loader",form:".tribe-block__tickets__item__attendee__fields__form",toggler:".tribe-block__tickets__registration__toggle__handler",status:".tribe-block__tickets__registration__status",field:{text:".tribe-block__tickets__item__attendee__field__text",checkbox:".tribe-block__tickets__item__attendee__field__checkbox",select:".tribe-block__tickets__item__attendee__field__select",radio:".tribe-block__tickets__item__attendee__field__radio"},checkout:".tribe-block__tickets__registration__checkout"},0!==o(n.selector.container).length&&(o(n.selector.container).on("click",n.selector.toggler,function(e){e.preventDefault();var t=o(this);t.closest(n.selector.container).find(n.selector.fields).toggle(),t.toggleClass("open")}),n.validateEventAttendees=function(e){var t=!0;return e.find(".tribe-tickets-meta-required").each(function(){var e=o(this);0===(e.is(n.selector.field.radio)||e.is(n.selector.field.checkbox)?e.find("input:checked").length?"checked":"":e.is(n.selector.field.select)?e.find("select").val():e.find("input, textarea").val().trim()).length&&(t=!1)}),t},n.handleSaveSubmission=function(e){e.preventDefault();var t=o(this),i=t.closest(n.selector.fields);if(i.find(n.selector.fieldsErrorRequired).hide(),i.find(n.selector.fieldsErrorAjax).hide(),n.validateEventAttendees(t)){i.find(n.selector.loader).show();var s=t.closest(n.selector.container).data("event-id"),r=t.serializeArray();r.push({name:"event_id",value:s}),r.push({name:"action",value:"tribe-tickets-save-attendee-info"}),o.post(TribeTicketsPlus.ajaxurl,r,function(e){e.success?e.data.meta_up_to_date&&o(n.selector.checkout).removeAttr("disabled"):i.find(n.selector.fieldsErrorAjax).show(),i.find(n.selector.loader).hide()})}else i.find(n.selector.fieldsErrorRequired).show(),o("html, body").animate({scrollTop:i.offset().top},300)},n.handleCheckoutSubmission=function(e){!n.hasChanges||confirm(tribe_l10n_datatables.registration_prompt)||e.preventDefault()},n.setHasChanges=function(){n.hasChanges=!0},n.bindFormFields=function(){[o(n.selector.field.text),o(n.selector.field.checkbox),o(n.selector.field.radio),o(n.selector.field.select)].forEach(function(e){(e.is(n.selector.field.radio)||e.is(n.selector.field.checkbox)?e.find("input"):e.is(n.selector.field.select)?e.find("select"):e.find("input, textarea")).change(n.setHasChanges)})},n.bindCheckout=function(){o(n.selector.checkout).submit(n.handleCheckoutSubmission)},n.bindEvents=function(){n.bindFormFields(),n.bindCheckout()},n.initPage=function(){o(n.selector.container).each(function(){var e=o(this);n.validateEventAttendees(e)?(e.find(n.selector.status).removeClass("incomplete"),e.find(n.selector.status).find("i").removeClass("dashicons-edit"),e.find(n.selector.status).find("i").addClass("dashicons-yes")):e.find(n.selector.status).addClass("incomplete");var t=e.find(n.selector.form);o(t).on("submit",n.handleSaveSubmission)}),n.bindEvents()},n.init=function(){n.initPage()},n.init())}(jQuery,tribe.tickets.registration);