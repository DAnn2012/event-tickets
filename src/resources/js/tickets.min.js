var ticketHeaderImage=window.ticketHeaderImage||{};!function(e,t,i){"use strict";var a=t(document.getElementById("tribe-event-datepickers")),n=t(document.getElementById("tribetickets")),r=t(document.getElementById("event_tickets")),d=t(document.getElementById("tribe-tickets-enable-global-stock")),c=t(document.getElementById("tribe-tickets-global-stock-level")),o=!1,s=t("html, body"),l=0,g=t(document.getElementById("tribe_panel_base")),m=t(document.getElementById("tribe_panel_edit")),_=t(document.getElementById("tribe_panel_settings"));ticketHeaderImage={uploader:function(){var e=wp.media({title:HeaderImageData.title,multiple:!1,library:{type:"image"},button:{text:HeaderImageData.button}});return e.on("close",function(){var t=e.state().get("selection").toJSON();t.length&&ticketHeaderImage.render(t[0])}),e.open(),!1},render:function(e){t(document.getElementById("tribe_ticket_header_preview")).html(ticketHeaderImage.imgHTML(e)),t(document.getElementById("tribe_ticket_header_image_id")).val(e.id),t(document.getElementById("tribe_ticket_header_remove")).show()},imgHTML:function(e){var t='<img src="'+e.url+'" ';return t+='width="'+e.width+'" ',t+='height="'+e.height+'" ',t+="/>"}},t(document).ready(function(){function u(){return d.prop("checked")}function k(){o=!0,n.trigger("set-global-stock-fields.tribe")}function p(){t("tr.ticket_advanced").hide(),t("tr.ticket_advanced_"+f()+":not(.sale_price)").show(),n.trigger("set-advanced-fields.tribe"),t(document.getElementById("tribetickets")).trigger("ticket-provider-changed.tribe")}function f(){var e=t('input[name="ticket_provider"]:checked');return e.length>0?e[0].value:""}function h(){var e=n.find("tr.ticket_advanced.history");if(e.length){var t=e.find("a.toggle-history"),i=t.find("span"),a=e.find("ul");e.find("a.toggle-history").click(function(e){return i.toggle(),a.toggle(),e.stopPropagation(),!1})}}function b(e,t){e.preventDefault(),i!==t.attr("aria-hidden")&&"false"!==t.attr("aria-hidden")?(g!==t&&g.attr("aria-hidden","true"),t.attr("aria-hidden","false")):(t.attr("aria-hidden","true"),g!==t&&g.attr("aria-hidden","false"))}n.on({"spin.tribe":function(e,i){("undefined"==typeof i||t.inArray(i,["start","stop"]))&&(i="stop"),"stop"===i?r.css("opacity","1").find("#tribe-loading").hide():r.css("opacity","0.5").find("#tribe-loading").show()},"clear.tribe":function(){var e=t(this),i=e.find("#ticket_form"),a=i.find("div:not(.event-wide-settings)");a.find('input:not(:button):not(:radio):not(:checkbox):not([type="hidden"]), textarea').val(""),a.find("input:checkbox").attr("checked",!1),a.find("#ticket_id").val(""),e.find('#ticket_form input[name="show_attendee_info"]').prop("checked",!1).change(),e.find("input[data-default-value]").each(function(){var e=t(this);e.val(e.data("default-value"))}),e.find("#ticket_start_date").datepicker("option","maxDate",null),e.find("#ticket_end_date").datepicker("option","minDate",null),e.find("#ticket_price").removeProp("disabled").siblings(".no-update-message").html("").hide().end().siblings(".description").show(),t("#tribe-tickets-attendee-sortables").empty(),t(".tribe-tickets-attendee-saved-fields").show(),i.find(".accordion-header, .accordion-content").removeClass("is-active")},"focus.tribe":function(){s.animate({scrollTop:r.offset().top-50},500)},"edit-tickets-complete.tribe":function(){h()},"set-advanced-fields.tribe":function(){var e=t(this),i=e.find("#ticket_form"),a=i.find("tr.ticket_advanced:not(.ticket_advanced_meta)").find("input, select, textarea"),r=i.find(".ticket_provider:checked").val();a.each(function(){var e=t(this);e.attr("name")&&e.data("name",e.attr("name")).attr({name:"",id:""}),e.closest("tr").hasClass("ticket_advanced_"+r)&&e.data("name")&&0===e.attr("name").length&&e.attr({name:e.data("name"),id:e.data("name")})}),n.trigger("set-global-stock-fields.tribe"),t(document.getElementById("ticket_global_stock")).change(function(){n.trigger("set-global-stock-fields.tribe")})},"set-global-stock-fields.tribe":function(){var e=f(),i=t(this).find("#ticket_form").find(".ticket_advanced_"+e);if(!(i.length<1)){var a=i.filter(".stock"),n=i.filter(".global-stock-mode"),r=n.filter(".sales-cap-field"),d=t(document.getElementById("ticket_global_stock")).val(),o=u();if(c.toggle(o),n.toggle(u()),a.toggle(!o),o)switch(d){case"global":r.hide(),a.hide();break;case"capped":r.show(),a.hide();break;case"own":r.hide(),a.show()}}}}),a.length&&(l=a.data("startofweek"));var v={dateFormat:"yy-mm-dd",showAnim:"fadeIn",changeMonth:!0,changeYear:!0,numberOfMonths:3,firstDay:l,showButtonPanel:!1,onChange:function(){},onSelect:function(e,i){var a=t.datepicker.parseDate("yy-mm-dd",e);"ticket_start_date"===i.id?(t(document.getElementById("ticket_end_date")).datepicker("option","minDate",a),a?t(".ticket_start_time").show():t(".ticket_start_time").hide()):(t(document.getElementById("ticket_start_date")).datepicker("option","maxDate",a),a?t(".ticket_end_time").show():t(".ticket_end_time").hide())}};t.extend(v,tribe_l10n_datatables.datepicker),t(document.getElementById("ticket_start_date")).datepicker(v).keyup(function(e){8!==e.keyCode&&46!==e.keyCode||t.datepicker._clearDate(this)}),t(document.getElementById("ticket_end_date")).datepicker(v).keyup(function(e){8!==e.keyCode&&46!==e.keyCode||t.datepicker._clearDate(this)}),d.change(k),d.trigger("change"),o=!1,t("input[name=ticket_provider]:radio").change(function(){p()}),t("input[name=ticket_provider]:checked").each(function(){p()}),t(document.getElementById("settings_form_toggle")).on("click",function(e){b(e,_)}),t(document.getElementById("tribe_settings_form_cancel")).on("click",function(e){b(e,_)}),t(".ticket_form_toggle").on("click",function(e){b(e,m),"ticket_form_toggle"===t(this).attr("id")?t(document.getElementById("Tribe__Tickets_Plus__Commerce__WooCommerce__Main_radio")).prop("checked",!0):t(document.getElementById("Tribe__Tickets__RSVP_radio")).prop("checked",!0),n.trigger("clear.tribe").trigger("set-advanced-fields.tribe").trigger("focus.tribe"),t(document.getElementById("tribetickets")).trigger("ticket-provider-changed.tribe")}),t(document.getElementById("ticket_form_cancel")).on("click",function(e){b(e,m),n.trigger("clear.tribe").trigger("set-advanced-fields.tribe").trigger("focus.tribe")}),t(document.getElementById("ticket_form_save")).click(function(e){var i=t(document.getElementById("ticket_form_table")),a=i.find(".ticket_provider:checked").val(),r=i.find(".ticket, .ticket_advanced_meta, .ticket_advanced_"+a);n.trigger("save-ticket.tribe",e).trigger("spin.tribe","start");var d={action:"tribe-ticket-add-"+t("input[name=ticket_provider]:checked").val(),formdata:r.find(".ticket_field").serialize(),post_ID:t(document.getElementById("post_ID")).val(),nonce:TribeTickets.add_ticket_nonce};t.post(ajaxurl,d,function(e){n.trigger("saved-ticket.tribe",e),e.success&&(n.trigger("clear.tribe"),t("td.ticket_list_container").empty().html(e.data.html))},"json").complete(function(){n.trigger("spin.tribe","stop").trigger("focus.tribe")})}),n.on("click",".ticket_delete",function(e){if(!confirm(tribe_ticket_notices.confirm_alert))return!1;e.preventDefault(),n.trigger("delete-ticket.tribe",e).trigger("spin.tribe","start");var i={action:"tribe-ticket-delete-"+t(this).attr("attr-provider"),post_ID:t(document.getElementById("post_ID")).val(),ticket_id:t(this).attr("attr-ticket-id"),nonce:TribeTickets.remove_ticket_nonce};t.post(ajaxurl,i,function(e){n.trigger("deleted-ticket.tribe",e),e.success&&(n.trigger("clear.tribe"),t("td.ticket_list_container").empty().html(e.data))},"json").complete(function(){n.trigger("spin.tribe","stop")})}),n.on("click",".ticket_edit_button",function(e){e.preventDefault(),n.trigger("spin.tribe","start");var i={action:"tribe-ticket-edit-"+this.getAttribute("data-provider"),post_ID:t(document.getElementById("post_ID")).val(),ticket_id:this.getAttribute("data-ticket-id"),nonce:TribeTickets.edit_ticket_nonce};t.post(ajaxurl,i,function(e){if(n.trigger("clear.tribe").trigger("set-advanced-fields.tribe").trigger("edit-ticket.tribe",e),e){var i=e.data.price,a=i,r=!1;"undefined"!=typeof e.data.on_sale&&e.data.on_sale&&(r=!0,i=e.data.regular_price),console.log(e.data),t(document.getElementById("ticket_id")).val(e.data.ID),t(document.getElementById("ticket_name")).val(e.data.name),t(document.getElementById("ticket_description")).val(e.data.description),r&&t(".ticket_advanced_"+e.data.provider_class+".sale_price").show();var d=e.data.start_date.substring(0,10),c=e.data.end_date.substring(0,10);t(document.getElementById("ticket_start_date")).val(d),t(document.getElementById("ticket_end_date")).val(c);var o=(t(document.getElementById("ticket_start_meridian")),t(document.getElementById("ticket_end_meridian")));if(e.data.start_date){var s=parseInt(e.data.start_date.substring(11,13)),l="am";s>12&&(l="pm",s=parseInt(s)-12,s=("0"+s).slice(-2)),12===s&&(l="pm"),0===s&&"am"===l&&(s=12),s=s.toString(),1===s.length&&(s="0"+s),t(document.getElementById("ticket_start_hour")).val(s).trigger("change"),t(document.getElementById("ticket_start_minute")).val(e.data.start_date.substring(14,16)).trigger("change"),t(document.getElementById("ticket_start_meridian")).val(l).trigger("change")}if(e.data.end_date){var g=parseInt(e.data.end_date.substring(11,13)),m="am";g>12&&o.length&&(m="pm",g=parseInt(g)-12,g=("0"+g).slice(-2)),12===g&&(m="pm"),0===g&&"am"===m&&(g=12),g=g.toString(),1===g.length&&(g="0"+g),t(document.getElementById("ticket_end_hour")).val(g).trigger("change"),t(document.getElementById("ticket_end_minute")).val(e.data.end_date.substring(14,16)).trigger("change"),t(document.getElementById("ticket_end_meridian")).val(m).trigger("change"),t(".ticket_end_time").show()}var _=t("tr.ticket_advanced input");_.data("name",_.attr("name")).attr({name:"",id:""}),t("tr.ticket_advanced").remove(),t("tr.ticket.bottom").before(e.data.advanced_fields),t("input:radio[name=ticket_provider]").filter("[value="+e.data.provider_class+"]").click(),t("input[name=ticket_provider]:radio").change();var u=n.find("#ticket_price");u.val(i),"undefined"!=typeof e.data.disallow_update_price_message?u.siblings(".no-update-message").html(e.data.disallow_update_price_message):u.siblings(".no-update-message").html(""),"undefined"==typeof e.data.can_update_price||e.data.can_update_price?(u.removeProp("disabled"),u.siblings(".description").show(),u.siblings(".no-update-message").hide()):(u.prop("disabled","disabled"),u.siblings(".description").hide(),u.siblings(".no-update-message").show());var k=n.find("#ticket_sale_price");r?k.val(a).closest("tr").show():k.closest("tr").hide(),"undefined"!=typeof e.data.purchase_limit&&e.data.purchase_limit&&t(document.getElementById("ticket_purchase_limit")).val(e.data.purchase_limit),n.find(".tribe-bumpdown-trigger").bumpdown(),t("a#ticket_form_toggle").hide(),n.trigger("set-advanced-fields.tribe").trigger("edit-ticket.tribe",e)}},"json").complete(function(){n.trigger("spin.tribe","stop").trigger("focus.tribe").trigger("edit-tickets-complete.tribe"),b(e,m)})}).on("keyup","#ticket_price",function(e){e.preventDefault();var i=price_format.decimal,a=new RegExp("[^-0-9%\\"+i+"]+","gi"),n=t(this).val(),r=n.replace(a,"");n!==r&&t(this).val(r)}).on("click","#tribe_ticket_header_image, #tribe_ticket_header_preview",function(e){e.preventDefault(),ticketHeaderImage.uploader("","")}).on("click","#tribe_settings_form_save",function(e){e.preventDefault();var i=t(document.getElementById("tribe_panel_settings")),a={action:"tribe-ticket-save-settings",formdata:i.find(".settings_field").serialize(),post_ID:t(document.getElementById("post_ID")).val(),nonce:TribeTickets.add_ticket_nonce};t.post(ajaxurl,a,function(e){n.trigger("saved-image.tribe",e)},"json")});var y=t(document.getElementById("tribe_ticket_header_remove")),I=t(document.getElementById("tribe_ticket_header_preview"));if(I.find("img").length&&y.show(),c.change(function(){o=!0}),t('input[type="submit"]').click(function(){o=!1}),t(e).on("beforeunload",function(){if(o)return tribe_global_stock_admin_ui.nav_away_msg}),t("body").on("click","#tribe_ticket_header_remove",function(e){e.preventDefault(),I.html(""),y.hide(),t(document.getElementById("tribe_ticket_header_image_id")).val("")}),t(document.getElementById("tribe_ticket_header_preview img")).length){var B=t(document.getElementById("tribe_ticket_header_preview img"));B.removeAttr("width").removeAttr("height"),n.width()<B.width()&&B.css("width","95%")}})}(window,jQuery);