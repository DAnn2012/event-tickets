var ticketHeaderImage=window.ticketHeaderImage||{};!function(e,t,i){"use strict";function a(e,t){"undefined"==typeof e&&(e="");var i=T;return!0===t&&(i=x[0]),i=i.toUpperCase().replace("YY","YYYY"),moment(e,i).format(T.toUpperCase().replace("YY","YYYY"))}function n(e){return"undefined"==typeof e&&(e=""),moment(e,C).format(C)}function d(){var e=t("input[name=default_ticket_provider]","#tribe_panel_settings").filter(":checked");return e.length>0?e.val():"Tribe__Tickets__RSVP"}function c(e){e="undefined"!=typeof e;var i=t('input[name="default_ticket_provider"]',"#tribe_panel_settings").filter(":checked"),a="Tribe__Tickets__RSVP_radio";!e&&i.length>0&&(a=i.val()+"_radio"),t(document.getElementById(a)).prop("checked",!0).trigger("change")}function r(){var e=m.find(".ticket_advanced.history");e.length&&e.on("click",".toggle-history",function(t){t.preventDefault(),e.hasClass("_show")?e.removeClass("_show"):e.addClass("_show")})}function o(){var e=t(document.getElementById("settings_global_capacity_edit"));return 0<e.length&&0<e.val()?e.val():0}function l(i,a){i&&i.preventDefault(),"undefined"==typeof a&&(a=k),f.each(function(){t(this).attr("aria-hidden",!0)}),a.attr("aria-hidden",!1),a.is(k)?t(e).off("beforeunload.tribe"):t(e).on("beforeunload.tribe",Y)}function s(e,i){i="undefined"==typeof i;var a=k.find(".tribe-ticket-field-order"),n={action:"tribe-ticket-refresh-panels",notice:e,post_ID:p.val(),data:a.serialize(),nonce:TribeTickets.add_ticket_nonce};"settings-cancel"===e&&(n.action="tribe-ticket-refresh-settings"),t.post(ajaxurl,n,function(e){if(e.data.ticket_table&&""!=e.data.ticket_table){var i=t(document.getElementById("ticket_list_wrapper"));if(0===i.length){var a=t(".tribe_sectionheader.ticket_list_container");i=t("<div>",{id:"ticket_list_wrapper"}),a.append(i),a.hasClass("tribe_no_capacity")&&a.removeClass("tribe_no_capacity")}i.empty();var n=t("<div>");n.html(e.data.ticket_table),i.append(n)}if("undefined"!=typeof e.data.capacity_table&&t(document.getElementById("tribe_expanded_capacity_table")).replaceWith(e.data.capacity_table),"undefined"!=typeof e.data.settings_panel){var d=t(e.data.settings_panel);y.replaceWith(d),y=d}if("undefined"!=typeof e.data.total_capacity){var r=t(document.getElementById("ticket_form_total_capacity"));if(0<r.length)r.replaceWith(e.data.total_capacity);else{var o=t('<div class="ticket_table_intro">');o.append(e.data.total_capacity),t(".ticket_list_container").removeClass("tribe_no_capacity").prepend(o)}}c()}).complete(function(e){m.trigger("tribe-tickets-refresh-tables",e.data),i&&l()})}var _=(t("html, body"),t(document)),m=t(document.getElementById("tribetickets"));if(0!==m.length){var p=(t(document.getElementById("event_tickets")),t(document.getElementById("post_ID"))),g=m.find(".tribe-tickets-editor-blocker"),u=m.find(".spinner"),f=t(document.getElementById("event_tickets")).find(".ticket_panel"),k=t(document.getElementById("tribe_panel_base")),v=t(document.getElementById("tribe_panel_edit")),y=t(document.getElementById("tribe_panel_settings")),b=t(document.getElementById("tribe-event-datepickers")),h=t(document.getElementById("ticket_start_date")),I=t(document.getElementById("ticket_end_date")),E=t(document.getElementById("ticket_start_time")),B=t(document.getElementById("ticket_end_time")),w=0,D=t(document.getElementById("tribe_ticket_header_preview")),x=["yy-mm-dd","m/d/yy","mm/dd/yy","d/m/yy","dd/mm/yy","m-d-yy","mm-dd-yy","d-m-yy","dd-mm-yy","yy.mm.dd","mm.dd.yy","dd.mm.yy"],T=x[0],C="HH:mmA",j=function(e,a){if("undefined"==typeof a){var n=t(this);a=n.val()}if(i!==a){a||(a=0),a=parseInt(a,10);var d=t(".tribe-ticket-capacity-max"),c=d.find(".tribe-ticket-capacity-value"),r=t('[name="tribe-ticket[capacity]"]');r.attr("placeholder",a),a?r.attr("max",a):a=0,c.text(a)}},Y=function(e){var t=!1;return m.find(".ticket_panel").filter('[aria-hidden="false"]').is(k)&&(t=tribe_global_stock_admin_ui.nav_away_msg),e.returnValue=t,t};ticketHeaderImage={uploader:function(){var e=wp.media({title:HeaderImageData.title,multiple:!1,library:{type:"image"},button:{text:HeaderImageData.button}});return e.on("close",function(){var t=e.state().get("selection").toJSON();t.length&&ticketHeaderImage.render(t[0])}),e.open(),!1},render:function(e){D.html(ticketHeaderImage.imgHTML(e)),t(document.getElementById("tribe_ticket_header_image_id")).val(e.id),t(document.getElementById("tribe_ticket_header_remove")).show(),t(document.getElementById("tribe_tickets_image_preview_filename")).show().find(".filename").text(e.filename)},imgHTML:function(e){var t='<img src="'+e.url+'" ';return t+='width="'+e.width+'" ',t+='height="'+e.height+'" ',t+="/>"}},_.ajaxSend(function(e,i,a){"string"===t.type(a.data)&&-1!==a.data.indexOf("action=tribe-ticket")&&m.trigger("spin.tribe","start")}),_.ajaxComplete(function(e,i,a){"string"===t.type(a.data)&&-1!==a.data.indexOf("action=tribe-ticket")&&m.trigger("spin.tribe","stop")}),_.on({"spin.tribe":function(e,i){("undefined"==typeof i||t.inArray(i,["start","stop"]))&&(i="stop"),"stop"===i?(g.hide(),u.removeClass("is-active")):(g.show(),u.addClass("is-active"))},"clear.tribe":function(){var e=v.find('input:not(:button):not(:radio):not(:checkbox):not([type="hidden"]), textarea'),i=v.find("input:checkbox, input:radio"),a=v.find("#ticket_id");v.find("input[data-default-value]").each(function(){var e=t(this);e.val(e.data("default-value"))}),h.datepicker("option","maxDate",null),h.val(""),h.trigger("change"),E.val(""),E.trigger("change"),I.datepicker("option","minDate",null),I.val(""),I.trigger("change"),B.val(""),B.trigger("change"),v.find("#ticket_price").removeProp("disabled").siblings(".no-update-message").html("").hide().end().siblings(".description").show(),t(document.getElementById("tribe-tickets-attendee-sortables")).empty(),t(".accordion-content.is-active").removeClass("is-active"),t(document.getElementById("ticket_bottom_right")).empty(),v.find(".accordion-header, .accordion-content").removeClass("is-active"),e.val("").trigger("change"),i.prop("checked",!1).trigger("change"),a.val("").trigger("change"),v.find(".tribe-tickets-editor-history-container").remove()},"edit-tickets-complete.tribe":function(){r()}}),_.on("click","#settings_form_toggle",function(e){l(e,y)}),_.on("click","#tribe_settings_form_cancel",function(e){s("settings-cancel")}),_.on("click","#tribe_settings_form_save",function(e){e.preventDefault();var i=t(document.getElementById("settings_global_capacity_edit"));!1===i.prop("disabled")&&(i.blur(),i.prop("disabled",!0));var a=y.find(".settings_field").serialize(),n={action:"tribe-ticket-save-settings",formdata:a,post_ID:p.val(),nonce:TribeTickets.add_ticket_nonce};t.post(ajaxurl,n,function(e){m.trigger("saved-image.tribe",e),e.success&&s("settings")},"json")}),_.on("click",".ticket_form_toggle",function(e){e.preventDefault();var i=d(),a=o(),n=t(".tribe-ticket-capacity-max");n.find(".tribe-ticket-capacity-value");m.trigger("clear.tribe"),"rsvp_form_toggle"===t(this).closest("button").attr("id")?c(!0):(c(),t(document.getElementById(i+"_"+tribe_ticket_vars.stock_mode)).prop("checked",!0),t(document.getElementById(i+"_global_capacity")).val(a),0!==a&&""!==a?t(document.getElementById(i+"_global_stock_block")).find(".global_capacity-wrapper").addClass("screen-reader-text"):t(document.getElementById(i+"_global_stock_block")).find(".global_capacity-wrapper").removeClass("screen-reader-text"),j(e,a)),v.find(".tribe-dependency").trigger("verify.dependency"),t(document.getElementById("tribe_tickets_show_description")).prop("checked",!0),t(document.getElementById("ticket_sale_price")).closest(".input_block").hide(),"ticket_form_toggle"===t(this).attr("id")&&0<a&&t(document.getElementById(i+"_global_capacity")).prop("disabled",!0),t(".tribe-tickets-attendee-saved-fields").show(),l(e,v)}),_.on("click","#ticket_form_cancel",function(e){s(),m.trigger("clear.tribe")}),_.on("change",".tribe-ticket-field-capacity",function(e){var i=t(this),a=i.parents(".input_block").eq(0).find(".tribe-ticket-field-mode");i.val()&&a.val("capped")}),_.on("click.tribe",'[name="ticket_form_save"]',function(e){var i=t(document.getElementById("ticket_form_table"));if(i.trigger("validation.tribe"),!tribe.validation.hasErrors(i)){m.trigger("save-ticket.tribe",e);var a=k.find(".tribe-ticket-field-order"),n={action:"tribe-ticket-add-"+t("input[name=ticket_provider]:checked").val(),formdata:i.find(".ticket_field").serialize(),post_ID:p.val(),nonce:TribeTickets.add_ticket_nonce,menu_order:a.length,is_admin:t("body").hasClass("wp-admin")};t.post(ajaxurl,n,function(e){m.trigger("saved-ticket.tribe",e),e.success&&s("ticket")},"json")}}),_.on("click",".ticket_delete",function(e){if(!confirm(tribe_ticket_notices.confirm_alert))return!1;e.preventDefault(),m.trigger("delete-ticket.tribe",e);var i=t(this).attr("attr-ticket-id"),a={action:"tribe-ticket-delete-"+t(this).attr("attr-provider"),post_ID:p.val(),ticket_id:i,nonce:TribeTickets.remove_ticket_nonce};t.post(ajaxurl,a,function(a){if(m.trigger("deleted-ticket.tribe",a),a.success){var n=t(document.getElementById("tribe_ticket_list_table")).find('[data-ticket-order-id="order_'+i+'"]');n.remove(),s("delete"),l(e)}},"json")}),_.on("click",".ticket_edit_button",function(d){d.preventDefault();var c=this.getAttribute("data-ticket-id"),r={action:"tribe-ticket-edit-"+this.getAttribute("data-provider"),post_ID:p.val(),ticket_id:c,nonce:TribeTickets.edit_ticket_nonce,is_admin:t("body").hasClass("wp-admin")};t.post(ajaxurl,r,function(c){if(c){var r,o,l,s,_=c.data.price,p=_,g=!1,u=c.data.provider_class,f=t(".tribe-ticket-capacity-max");f.find(".tribe-ticket-capacity-value");if(t("input:radio[name=ticket_provider]").filter("[value="+c.data.provider_class+"]").click(),t("input[name=ticket_provider]:radio").change(),c.data.global_stock_mode)switch(c.data.global_stock_mode){case"global":t(document.getElementById(u+"_global")).prop("checked",!0).val("global"),t(document.getElementById(u+"_global_capacity")).attr("placeholder",c.data.event_capacity).val(c.data.event_capacity).prop("disabled",!0),t(document.getElementById(u+"_global_stock_cap")).val(""),j(d,c.data.event_capacity);break;case"capped":t(document.getElementById(u+"_global")).prop("checked",!0).val("capped"),t(document.getElementById(u+"_global_capacity")).attr("placeholder",c.data.event_capacity).val(c.data.event_capacity).prop("disabled",!0),t(document.getElementById(u+"_global_stock_cap")).val(c.data.capacity),j(d,c.data.event_capacity);break;case"own":t(document.getElementById(u+"_own")).prop("checked",!0),t(document.getElementById(u+"_capacity")).val(c.data.capacity);break;default:t(document.getElementById(u+"_unlimited")).prop("checked",!0),t(document.getElementById(u+"_global_stock_cap")).val("")}else t(document.getElementById(c.data.provider_class+"_unlimited")).prop("checked",!0),t(document.querySelectorAll(".ticket_stock")).val(c.data.original_stock);t("input[name=ticket_global_stock]:radio").change(),t(document.getElementById("ticket_id")).val(c.data.ID),t(document.getElementById("ticket_name")).val(c.data.name),t(document.getElementById("ticket_description")).val(c.data.description),c.data.show_description||1===parseInt(c.data.show_description,10)?t(document.getElementById("tribe_tickets_show_description")).prop("checked",!0):t(document.getElementById("tribe_tickets_show_description")).removeAttr("checked"),c.data.start_date?r=a(c.data.start_date,!0):i!==t(document.getElementById("EventStartDate")).val()&&(r=a(t(document.getElementById("EventStartDate")).val())),c.data.start_time?o=n(c.data.start_time):i!==t(document.getElementById("EventStartTime")).val()&&(o=n(t(document.getElementById("EventStartTime")).val())),r&&h.val(r).trigger("change"),o&&E.val(o).trigger("change"),c.data.end_date?l=a(c.data.end_date,!0):i!==t(document.getElementById("EventEndDate")).val()&&(l=a(t(document.getElementById("EventEndDate")).val())),c.data.end_time?s=n(c.data.end_time):i!==t(document.getElementById("EventEndTime")).val()&&(s=n(t(document.getElementById("EventEndTime")).val())),l&&I.val(l).trigger("change"),s&&B.val(s).trigger("change"),t(document.getElementById("advanced_fields")).empty("").append(c.data.advanced_fields),"undefined"!=typeof c.data.on_sale&&c.data.on_sale&&(g=!0,_=c.data.regular_price);var k=m.find("#ticket_price");if(k.val(_),"undefined"!=typeof c.data.disallow_update_price_message?k.siblings(".no-update-message").html(c.data.disallow_update_price_message):k.siblings(".no-update-message").html(""),"undefined"==typeof c.data.can_update_price||c.data.can_update_price?(k.removeProp("disabled"),k.siblings(".description").show(),k.siblings(".no-update-message").hide()):(k.prop("disabled","disabled"),k.siblings(".description").hide(),k.siblings(".no-update-message").show()),"undefined"!=typeof c.data.history){var y=t(c.data.history);v.find(".accordion").append(y),e.MTAccordion({target:".accordion"})}else v.find(".tribe-tickets-editor-history-container").remove();var b=t(document.getElementById("ticket_sale_price")),w=b.closest(".input_block");g?(b.prop("readonly",!1).val(p).prop("readonly",!0),w.show()):w.hide(),"undefined"!=typeof c.data.purchase_limit&&c.data.purchase_limit&&t(document.getElementById("ticket_purchase_limit")).val(c.data.purchase_limit),c.data.sku&&t(document.querySelectorAll(".sku_input")).val(c.data.sku),t(document.getElementById("tribe-tickets-attendee-sortables")).empty(),"undefined"!=typeof c.data.attendee_fields&&c.data.attendee_fields?(t(document.getElementById("tribe-tickets-attendee-sortables")).html(c.data.attendee_fields),t(".tribe-tickets-attendee-saved-fields").hide()):t(".tribe-tickets-attendee-saved-fields").show(),"undefined"!=typeof c.data.controls&&c.data.controls&&t(document.getElementById("ticket_bottom_right")).html(c.data.controls),m.find(".tribe-bumpdown-trigger").bumpdown(),t("a#ticket_form_toggle").hide(),v.find(".tribe-dependency").trigger("verify.dependency")}},"json").always(function(e){m.trigger("edit-tickets-complete.tribe"),v.find(".tribe-dependency").trigger("verify.dependency"),e.data.event_capacity&&t(document.getElementById(e.data.provider_class+"_global_capacity")).prop("disabled",!0),l(d,v)})}),_.on("click","#global_capacity_edit_button",function(e){e.preventDefault(),t(document.getElementById("settings_global_capacity_edit")).prop("disabled",!1).focus()}),_.on("keyup","#ticket_price",function(e){e.preventDefault();var i=price_format.decimal,a=new RegExp("[^-0-9%\\"+i+"]+","gi"),n=t(this).val(),d=n.replace(a,"");n!==d&&t(this).val(d)}),_.on("click","#tribe_ticket_header_image, #tribe_ticket_header_preview",function(e){e.preventDefault(),ticketHeaderImage.uploader("","")}),_.on("blur","#settings_global_capacity_edit",function(){var e=t(this),i=e.val();""===i&&(e.val(0),i=0);var a={action:"tribe-events-edit-global-capacity",post_ID:p.val(),capacity:i,nonce:TribeTickets.edit_ticket_nonce};t.post(ajaxurl,a,function(e){t(document.getElementById("settings_global_capacity_edit")).prop("disabled",!0),s(null,!1)})}),_.on("blur",'[name="tribe-ticket[event_capacity]"]',j),_.on("change",'[name="tribe-ticket[capacity]"]',function(e){var i=t(this),a=parseInt(i.attr("max"),10),n=parseInt(i.val(),10);a&&a<n&&i.val(a)}),_.on("change","#tribe-tickets-global-stock-level",j),_.on("click","#tribe_ticket_header_remove",function(e){e.preventDefault(),t(document.getElementById("tribe_ticket_header_preview")).html(""),t(document.getElementById("tribe_ticket_header_remove")).hide(),t(document.getElementById("tribe_tickets_image_preview_filename")).hide().find(".filename").text(""),t(document.getElementById("tribe_ticket_header_image_id")).val("")}),_.ready(function(){if(b.length&&(w=b.data("startofweek")),"undefined"!=typeof tribe_dynamic_help_text){var e=t.isNumeric(tribe_dynamic_help_text.datepicker_format_index)?tribe_dynamic_help_text.datepicker_format_index:0;T=x[e]}var i={dateFormat:T,showAnim:"fadeIn",changeMonth:!0,changeYear:!0,numberOfMonths:3,firstDay:w,showButtonPanel:!1,onChange:function(){},onSelect:function(e,i){var a=t.datepicker.parseDate(T,e);"ticket_start_date"===i.id?I.datepicker("option","minDate",a):h.datepicker("option","maxDate",a)}};t.extend(i,tribe_l10n_datatables.datepicker);var a=m.find(".tribe-timepicker:not(.ui-timepicker-input)");if(tribe_timepickers.setup_timepickers(a),h.datepicker(i).datepicker("option","defaultDate",t(document.getElementById("EventStartDate")).val()).keyup(function(e){8!==e.keyCode&&46!==e.keyCode||t.datepicker._clearDate(this)}),I.datepicker(i).datepicker("option","defaultDate",t(document.getElementById("EventEndDate")).val()).keyup(function(e){8!==e.keyCode&&46!==e.keyCode||t.datepicker._clearDate(this)}),D.find("img").length){t(document.getElementById("tribe_ticket_header_remove")).show();var n=D.find("img");n.removeAttr("width").removeAttr("height"),m.width()<n.width()&&n.css("width","95%")}})}}(window,jQuery);