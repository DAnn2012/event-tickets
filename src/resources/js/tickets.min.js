var ticketHeaderImage=window.ticketHeaderImage||{};!function(e,t,i){"use strict";var a=t(document.getElementById("tribe-event-datepickers")),n=t(document.getElementById("tribetickets")),d=t(document.getElementById("event_tickets")),c=(t(document.getElementById("tribe-tickets-enable-global-stock")),t(document.getElementById("tribe-tickets-global-stock-level"))),r=!1,o=t("html, body"),l=0,s=t(document.getElementById("event_tickets")).find(".ticket_panel"),_=t(document.getElementById("tribe_panel_base")),m=t(document.getElementById("tribe_panel_edit")),g=t(document.getElementById("tribe_panel_settings"));ticketHeaderImage={uploader:function(){var e=wp.media({title:HeaderImageData.title,multiple:!1,library:{type:"image"},button:{text:HeaderImageData.button}});return e.on("close",function(){var t=e.state().get("selection").toJSON();t.length&&ticketHeaderImage.render(t[0])}),e.open(),!1},render:function(e){t(document.getElementById("tribe_ticket_header_preview")).html(ticketHeaderImage.imgHTML(e)),t(document.getElementById("tribe_ticket_header_image_id")).val(e.id),t(document.getElementById("tribe_ticket_header_remove")).show(),t(document.getElementById("tribe_tickets_image_preview_filename")).find(".filename").text(e.filename),t(document.getElementById("#tribe_tickets_image_preview_filename")).show()},imgHTML:function(e){var t='<img src="'+e.url+'" ';return t+='width="'+e.width+'" ',t+='height="'+e.height+'" ',t+="/>"}},t(document).ready(function(){function p(){var e=t("#tribe_panel_settings input[name=default_ticket_provider]").filter(":checked");return e.length>0?e.val():"Tribe__Tickets__RSVP"}function u(){var e=t(document.getElementById("settings_global_capacity_edit"));return e.length>0?e.val():""}function k(){var e=n.find(".ticket_advanced.history");if(e.length){var t=e.find("a.toggle-history");t.find("span"),e.find("ul");e.on("click",".toggle-history",function(t){t.preventDefault(),e.hasClass("_show")?e.removeClass("_show"):e.addClass("_show")})}}function b(e,a){e&&e.preventDefault(),i==a&&(a=_),s.each(function(){t(this).attr("aria-hidden",!0)}),a.attr("aria-hidden",!1)}function v(e,a){var n=!1,d=!1,c=t(document.getElementById("ticket_title_edit")),r=t(document.getElementById("ticket_title_add")),o=t(document.getElementById("rsvp_title_edit")),l=t(document.getElementById("rsvp_title_add")),s=t(document.getElementById("ticket_form_save")),_=t(document.getElementById("rsvp_form_save")),m=t(e.target).closest("button");i===a?"ticket_form_toggle"===m.attr("id")&&(n=!0):(d=!0,"Tribe__Tickets__RSVP"!==m.attr("data-provider")&&(n=!0)),n?(o.hide(),l.hide(),_.hide(),s.show(),d?(c.show(),r.hide()):(r.show(),c.hide())):(c.hide(),r.hide(),s.hide(),_.show(),d?(o.show(),l.hide()):(l.show(),o.hide()))}function f(e,a){a=i===a;var d={action:"tribe-ticket-refresh-panels",notice:e,post_ID:t(document.getElementById("post_ID")).val(),nonce:TribeTickets.add_ticket_nonce};t.post(ajaxurl,d,function(e){if(e.data.ticket_table&&""!=e.data.ticket_table){var i=t(document.getElementById("ticket_list_wrapper"));if(0===i.length){t(".tribe_sectionheader.ticket_list_container");i=t("<div>",{id:"ticket_list_wrapper"}),container.append(ticket_table),container.hasClass("tribe_no_capacity")&&container.removeClass("tribe_no_capacity")}i.empty();var a=t("<div>");a.html(e.data.ticket_table),i.append(a)}n.trigger("tribe-tickets-refresh-tables",e.data)}).complete(function(e){a&&b()})}n.on({"spin.tribe":function(e,i){("undefined"==typeof i||t.inArray(i,["start","stop"]))&&(i="stop"),"stop"===i?d.css("opacity","1").find("#tribe-loading").hide():d.css("opacity","0.5").find("#tribe-loading").show()},"clear.tribe":function(){var e=t(document.getElementById("tribe_panel_edit"));e.find('input:not(:button):not(:radio):not(:checkbox):not([type="hidden"]), textarea').val(""),e.find("input:checkbox, input:radio").prop("checked",!1),e.find("#ticket_id").val(""),e.find("input[data-default-value]").each(function(){var e=t(this);e.val(e.data("default-value"))}),e.find("#ticket_start_date").datepicker("option","maxDate",null),e.find("#ticket_end_date").datepicker("option","minDate",null),e.find("#ticket_price").removeProp("disabled").siblings(".no-update-message").html("").hide().end().siblings(".description").show(),t(document.getElementById("tribe-tickets-attendee-sortables")).empty(),t(".accordion-content.is-active").removeClass("is-active"),t(document.getElementById("ticket_bottom_right")).empty(),e.find(".accordion-header, .accordion-content").removeClass("is-active")},"focus.tribe":function(){o.animate({scrollTop:d.offset().top-50},500)},"edit-tickets-complete.tribe":function(){k()},"set-advanced-fields.tribe":function(){var e=t(this),i=e.find("#ticket_form"),a=i.find("tr.ticket_advanced:not(.ticket_advanced_meta)").find("input, select, textarea"),n=i.find(".ticket_provider:checked").val();a.each(function(){var e=t(this);e.attr("name")&&e.data("name",e.attr("name")).attr({name:"",id:""}),e.closest("tr").hasClass("ticket_advanced_"+n)&&e.data("name")&&0===e.attr("name").length&&e.attr({name:e.data("name"),id:e.data("name")})})}}),a.length&&(l=a.data("startofweek"));var h={dateFormat:"yy-mm-dd",showAnim:"fadeIn",changeMonth:!0,changeYear:!0,numberOfMonths:3,firstDay:l,showButtonPanel:!1,onChange:function(){},onSelect:function(e,i){var a=t.datepicker.parseDate("yy-mm-dd",e);"ticket_start_date"===i.id?(t(document.getElementById("ticket_end_date")).datepicker("option","minDate",a),a?t(".ticket_start_time").show():t(".ticket_start_time").hide()):(t(document.getElementById("ticket_start_date")).datepicker("option","maxDate",a),a?t(".ticket_end_time").show():t(".ticket_end_time").hide())}};t.extend(h,tribe_l10n_datatables.datepicker),t(document.getElementById("ticket_start_date")).datepicker(h).keyup(function(e){8!==e.keyCode&&46!==e.keyCode||t.datepicker._clearDate(this)}),t(document.getElementById("ticket_end_date")).datepicker(h).keyup(function(e){8!==e.keyCode&&46!==e.keyCode||t.datepicker._clearDate(this)}),t(document.getElementById("settings_form_toggle")).on("click",function(e){b(e,g)}),t(document.getElementById("tribe_settings_form_cancel")).on("click",function(e){b(e)}),t(".ticket_form_toggle").on("click",function(e){var a=p(),d=u();n.trigger("clear.tribe").trigger("focus.tribe"),"ticket_form_toggle"===t(this).attr("id")?(t(document.getElementById(a+"_radio")).prop("checked",!0),t(document.getElementById(a+"_global")).prop("checked",!0),t(document.getElementById(a+"_global_capacity")).val(d)):t(document.getElementById("Tribe__Tickets__RSVP_radio")).prop("checked",!0),t(document.getElementById("tribe_panel_edit")).find(".tribe-dependency").trigger("verify.dependency"),n.trigger("ticket-provider-changed.tribe"),"ticket_form_toggle"===t(this).attr("id")&&i!==d&&0<d&&t(document.getElementById(a+"_global_capacity")).prop("disabled",!0),v(e),b(e,m)}),t(document.getElementById("ticket_form_cancel")).on("click",function(e){b(e),n.trigger("clear.tribe").trigger("set-advanced-fields.tribe").trigger("focus.tribe")}),t(document).on("blur",'[name="global_stock_cap"]',function(e){var i=t(this),a=i.closest("fieldset").find('[name="ticket_global_stock"]'),n="global";0<i.val()&&(n="capped"),a.val(n)}),t(document.getElementById("ticket_form_save")).add(t(document.getElementById("rsvp_form_save"))).on("click",function(e){var i=t(document.getElementById("ticket_form_table"));i.find(".ticket_provider:checked").val();n.trigger("save-ticket.tribe",e).trigger("spin.tribe","start");var a=i.find(".ticket_field").serialize(),d={action:"tribe-ticket-add-"+t("input[name=ticket_provider]:checked").val(),formdata:a,post_ID:t(document.getElementById("post_ID")).val(),nonce:TribeTickets.add_ticket_nonce};t.post(ajaxurl,d,function(e){n.trigger("saved-ticket.tribe",e),e.success&&f("ticket")},"json").complete(function(){n.trigger("spin.tribe","stop").trigger("focus.tribe")})}),n.on("click",".ticket_delete",function(e){if(!confirm(tribe_ticket_notices.confirm_alert))return!1;e.preventDefault(),n.trigger("delete-ticket.tribe",e).trigger("spin.tribe","start");var i=t(this).attr("attr-ticket-id"),a={action:"tribe-ticket-delete-"+t(this).attr("attr-provider"),post_ID:t(document.getElementById("post_ID")).val(),ticket_id:i,nonce:TribeTickets.remove_ticket_nonce};t.post(ajaxurl,a,function(a){if(n.trigger("deleted-ticket.tribe",a),a.success){var d=t(document.getElementById("tribe_ticket_list_table")).find('[data-ticket-order-id="order_'+i+'"]');d.remove(),f("delete"),b(e)}},"json").complete(function(){n.trigger("spin.tribe","stop")})}),n.on("click",".ticket_edit_button",function(e){e.preventDefault(),n.trigger("spin.tribe","start");var a=this.getAttribute("data-ticket-id"),d={action:"tribe-ticket-edit-"+this.getAttribute("data-provider"),post_ID:t(document.getElementById("post_ID")).val(),ticket_id:a,nonce:TribeTickets.edit_ticket_nonce};v(e,a),t.post(ajaxurl,d,function(e){if(e){var a=e.data.price,d=a,c=!1;if("undefined"!=typeof e.data.on_sale&&e.data.on_sale&&(c=!0,a=e.data.regular_price),t("input:radio[name=ticket_provider]").filter("[value="+e.data.provider_class+"]").click(),t("input[name=ticket_provider]:radio").change(),e.data.global_stock_mode)switch(e.data.global_stock_mode){case"global":case"capped":t(document.getElementById(e.data.provider_class+"_global")).prop("checked",!0),t(document.getElementById(e.data.provider_class+"_global_capacity")).val(e.data.total_global_stock).prop("disabled",!0),i!==e.data.global_stock_cap&&0<e.data.global_stock_cap?(t(document.getElementById(e.data.provider_class+"_global")).val("capped"),t(document.getElementById(e.data.provider_class+"_global_stock_cap")).val(e.data.global_stock_cap)):(t(document.getElementById(e.data.provider_class+"_global")).val("global"),t(document.getElementById(e.data.provider_class+"_global_stock_cap")).val(""));break;case"own":t(document.getElementById(e.data.provider_class+"_own")).prop("checked",!0),t(document.getElementById(e.data.provider_class+"_capacity")).val(e.data.stock);break;default:t(document.getElementById(e.data.provider_class+"_unlimited")).prop("checked",!0),t(document.getElementById(e.data.provider_class+"_global_stock_cap")).val("")}else t(document.getElementById(e.data.provider_class+"_unlimited")).prop("checked",!0),t(document.querySelectorAll(".ticket_stock")).val(e.data.original_stock);t("input[name=ticket_global_stock]:radio").change(),t(document.getElementById("ticket_id")).val(e.data.ID),t(document.getElementById("ticket_name")).val(e.data.name),t(document.getElementById("ticket_description")).val(e.data.description),t(document.getElementById(e.data.provider_class+"_global_stock_cap")).val(e.data.global_stock_cap);var r=e.data.start_date.substring(0,10),o=e.data.end_date.substring(0,10);t(document.getElementById("ticket_start_date")).val(r),t(document.getElementById("ticket_end_date")).val(o);var l=(t(document.getElementById("ticket_start_meridian")),t(document.getElementById("ticket_end_meridian")));if(e.data.start_date){var s=parseInt(e.data.start_date.substring(11,13)),_="am";s>12&&(_="pm",s=parseInt(s)-12,s=("0"+s).slice(-2)),12===s&&(_="pm"),0===s&&"am"===_&&(s=12),s=s.toString(),1===s.length&&(s="0"+s),t(document.getElementById("ticket_start_hour")).val(s).trigger("change"),t(document.getElementById("ticket_start_minute")).val(e.data.start_date.substring(14,16)).trigger("change"),t(document.getElementById("ticket_start_meridian")).val(_).trigger("change")}if(e.data.end_date){var m=parseInt(e.data.end_date.substring(11,13)),g="am";m>12&&l.length&&(g="pm",m=parseInt(m)-12,m=("0"+m).slice(-2)),12===m&&(g="pm"),0===m&&"am"===g&&(m=12),m=m.toString(),1===m.length&&(m="0"+m),t(document.getElementById("ticket_end_hour")).val(m).trigger("change"),t(document.getElementById("ticket_end_minute")).val(e.data.end_date.substring(14,16)).trigger("change"),t(document.getElementById("ticket_end_meridian")).val(g).trigger("change"),t(".ticket_end_time").show()}t(document.getElementById(e.data.provider_class+"_advanced")).replaceWith(e.data.advanced_fields);var p=n.find("#ticket_price");p.val(a),"undefined"!=typeof e.data.disallow_update_price_message?p.siblings(".no-update-message").html(e.data.disallow_update_price_message):p.siblings(".no-update-message").html(""),"undefined"==typeof e.data.can_update_price||e.data.can_update_price?(p.removeProp("disabled"),p.siblings(".description").show(),p.siblings(".no-update-message").hide()):(p.prop("disabled","disabled"),p.siblings(".description").hide(),p.siblings(".no-update-message").show());var u=t(document.getElementById("ticket_sale_price")),k=u.closest(".input_block");c?(u.prop("readonly",!1).val(d).prop("readonly",!0),k.show()):k.hide(),"undefined"!=typeof e.data.purchase_limit&&e.data.purchase_limit&&t(document.getElementById("ticket_purchase_limit")).val(e.data.purchase_limit),e.data.sku&&t(document.querySelectorAll(".sku_input")).val(e.data.sku),"undefined"!=typeof e.data.controls&&e.data.controls&&t(document.getElementById("ticket_bottom_right")).html(e.data.controls),n.find(".tribe-bumpdown-trigger").bumpdown(),t("a#ticket_form_toggle").hide(),t(document.getElementById("tribe_panel_edit")).find(".tribe-dependency").trigger("verify.dependency")}},"json").always(function(i){n.trigger("spin.tribe","stop").trigger("focus.tribe").trigger("edit-tickets-complete.tribe"),t(document.getElementById("tribe_panel_edit")).find(".tribe-dependency").trigger("verify.dependency"),i.data.total_global_stock&&t(document.getElementById(i.data.provider_class+"_global_capacity")).prop("disabled",!0),b(e,m)})}).on("keyup","#ticket_price",function(e){e.preventDefault();var i=price_format.decimal,a=new RegExp("[^-0-9%\\"+i+"]+","gi"),n=t(this).val(),d=n.replace(a,"");n!==d&&t(this).val(d)}).on("click","#tribe_ticket_header_image, #tribe_ticket_header_preview",function(e){e.preventDefault(),ticketHeaderImage.uploader("","")}).on("click","#tribe_settings_form_save",function(e){e.preventDefault();var i=t(document.getElementById("tribe_panel_settings")),a=i.find(".settings_field").serialize(),d=t(document.getElementById("settings_global_capacity_edit"));!1===d.prop("disabled")&&(d.blur(),d.prop("disabled",!0));var c={action:"tribe-ticket-save-settings",formdata:a,post_ID:t(document.getElementById("post_ID")).val(),nonce:TribeTickets.add_ticket_nonce};t.post(ajaxurl,c,function(e){n.trigger("saved-image.tribe",e),e.success&&f("settings")},"json")});var y=t(document.getElementById("tribe_ticket_header_remove")),I=t(document.getElementById("tribe_ticket_header_preview"));if(I.find("img").length&&y.show(),c.change(function(){r=!0}),t('input[type="submit"]').click(function(){r=!1}),t(e).on("beforeunload",function(){if(r)return tribe_global_stock_admin_ui.nav_away_msg}),t(document).on("click",".global_capacity_edit_button",function(e){e.preventDefault(),t(document.getElementById("settings_global_capacity_edit")).prop("disabled",!1).focus()}),t(document).on("blur","#settings_global_capacity_edit",function(){var e=t(this).val(),i={action:"tribe-events-edit-global-capacity",post_ID:t(document.getElementById("post_ID")).val(),capacity:e,nonce:TribeTickets.edit_ticket_nonce};t.post(ajaxurl,i,function(e){f(null,!1)})}),t("body").on("click","#tribe_ticket_header_remove",function(e){e.preventDefault(),I.html(""),y.hide(),t(document.getElementById("tribe_ticket_header_image_id")).val("")}),t(document.getElementById("tribe_ticket_header_preview img")).length){var B=t(document.getElementById("tribe_ticket_header_preview img"));B.removeAttr("width").removeAttr("height"),n.width()<B.width()&&B.css("width","95%")}})}(window,jQuery);