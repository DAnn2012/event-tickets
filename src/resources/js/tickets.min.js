var ticketHeaderImage=window.ticketHeaderImage||{};!function(e,t,i){"use strict";var a=t("html, body"),n=t(document.getElementById("tribetickets")),c=t(document.getElementById("event_tickets")),d=t(document.getElementById("post_ID")),o=t(document.getElementById("event_tickets")).find(".ticket_panel"),r=t(document.getElementById("tribe_panel_base")),l=t(document.getElementById("tribe_panel_edit")),s=t(document.getElementById("tribe_panel_settings")),_=(t(document.getElementById("tribe-tickets-enable-global-stock")),t(document.getElementById("tribe-tickets-global-stock-level")),t(document.getElementById("settings_global_capacity_edit"))),g=!1,m=t(document.getElementById("tribe-event-datepickers")),p=t(document.getElementById("ticket_start_date")),u=t(document.getElementById("ticket_end_date")),k=t(document.getElementById("ticket_start_time")),b=t(document.getElementById("ticket_end_time")),v=0,f=t(document.getElementById("tribe_ticket_header_preview")),y=t(document.getElementById("tribe_tickets_show_description"));ticketHeaderImage={uploader:function(){var e=wp.media({title:HeaderImageData.title,multiple:!1,library:{type:"image"},button:{text:HeaderImageData.button}});return e.on("close",function(){var t=e.state().get("selection").toJSON();t.length&&ticketHeaderImage.render(t[0])}),e.open(),!1},render:function(e){f.html(ticketHeaderImage.imgHTML(e)),t(document.getElementById("tribe_ticket_header_image_id")).val(e.id),t(document.getElementById("tribe_ticket_header_remove")).show(),t(document.getElementById("tribe_tickets_image_preview_filename")).show().find(".filename").text(e.filename)},imgHTML:function(e){var t='<img src="'+e.url+'" ';return t+='width="'+e.width+'" ',t+='height="'+e.height+'" ',t+="/>"}},t(document).ready(function(){function h(){var e=t("input[name=default_ticket_provider]","#tribe_panel_settings").filter(":checked");return e.length>0?e.val():"Tribe__Tickets__RSVP"}function I(e){e=i!==e;var a=t('input[name="default_ticket_provider"]',"#tribe_panel_settings").filter(":checked"),n="Tribe__Tickets__RSVP_radio";!e&&a.length>0&&(n=a.val()+"_radio"),t(document.getElementById(n)).prop("checked",!0).trigger("change")}function E(){return 0<_.length&&0<_.val()?_.val():""}function B(){var e=n.find(".ticket_advanced.history");if(e.length){var t=e.find("a.toggle-history");t.find("span"),e.find("ul");e.on("click",".toggle-history",function(t){t.preventDefault(),e.hasClass("_show")?e.removeClass("_show"):e.addClass("_show")})}}function w(e,a){e&&e.preventDefault(),i==a&&(a=r),o.each(function(){t(this).attr("aria-hidden",!0)}),a.attr("aria-hidden",!1)}function D(e,a){a=i===a;var c={action:"tribe-ticket-refresh-panels",notice:e,post_ID:d.val(),nonce:TribeTickets.add_ticket_nonce};t.post(ajaxurl,c,function(e){if(e.data.ticket_table&&""!=e.data.ticket_table){var i=t(document.getElementById("ticket_list_wrapper"));if(0===i.length){var a=t(".tribe_sectionheader.ticket_list_container");i=t("<div>",{id:"ticket_list_wrapper"}),a.append(i),a.hasClass("tribe_no_capacity")&&a.removeClass("tribe_no_capacity")}i.empty();var c=t("<div>");c.html(e.data.ticket_table),i.append(c)}if("undefined"!==e.data.capacity_table&&t(document.getElementById("tribe_expanded_capacity_table")).replaceWith(e.data.capacity_table),"undefined"!==e.data.total_capacity){var d=t(document.getElementById("ticket_form_total_capacity"));if(0<d.length)d.replaceWith(e.data.total_capacity);else{var o=t('<div class="ticket_table_intro">');o.append(e.data.total_capacity),t(".ticket_list_container").removeClass("tribe_no_capacity").prepend(o)}}I(),n.trigger("tribe-tickets-refresh-tables",e.data)}).complete(function(e){a&&w()})}m.length&&(v=m.data("startofweek"));var T={dateFormat:"yy-mm-dd",showAnim:"fadeIn",changeMonth:!0,changeYear:!0,numberOfMonths:3,firstDay:v,showButtonPanel:!1,onChange:function(){},onSelect:function(e,i){var a=t.datepicker.parseDate("yy-mm-dd",e);"ticket_start_date"===i.id?u.datepicker("option","minDate",a):p.datepicker("option","maxDate",a)}};t.extend(T,tribe_l10n_datatables.datepicker);var x=n.find(".tribe-timepicker:not(.ui-timepicker-input)");if(tribe_timepickers.setup_timepickers(x),p.datepicker(T).datepicker("option","defaultDate",t(document.getElementById("EventStartDate")).val()).keyup(function(e){8!==e.keyCode&&46!==e.keyCode||t.datepicker._clearDate(this)}),u.datepicker(T).datepicker("option","defaultDate",t(document.getElementById("EventEndDate")).val()).keyup(function(e){8!==e.keyCode&&46!==e.keyCode||t.datepicker._clearDate(this)}),n.on({"spin.tribe":function(e,i){("undefined"==typeof i||t.inArray(i,["start","stop"]))&&(i="stop"),"stop"===i?c.css("opacity","1").find("#tribe-loading").hide():c.css("opacity","0.5").find("#tribe-loading").show()},"clear.tribe":function(){l.find('input:not(:button):not(:radio):not(:checkbox):not([type="hidden"]), textarea').val(""),l.find("input:checkbox, input:radio").prop("checked",!1),l.find("#ticket_id").val(""),l.find("input[data-default-value]").each(function(){var e=t(this);e.val(e.data("default-value"))}),p.datepicker("option","maxDate",null).val(t.datepicker.formatDate("mm/dd/yy",new Date)).trigger("change"),k.val(new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"numeric"}).format(new Date)).trigger("change"),u.datepicker("option","minDate",null).val(t(document.getElementById("EventStartDate")).val()).trigger("change"),b.val(t(document.getElementById("EventEndTime")).val()).trigger("change"),l.find("#ticket_price").removeProp("disabled").siblings(".no-update-message").html("").hide().end().siblings(".description").show(),t(document.getElementById("tribe-tickets-attendee-sortables")).empty(),t(".accordion-content.is-active").removeClass("is-active"),t(document.getElementById("ticket_bottom_right")).empty(),l.find(".accordion-header, .accordion-content").removeClass("is-active")},"focus.tribe":function(){a.animate({scrollTop:c.offset().top-50},500)},"edit-tickets-complete.tribe":function(){B()}}).on("click","#settings_form_toggle",function(e){w(e,s)}).on("click","#tribe_settings_form_cancel",function(e){D()}).on("click","#tribe_settings_form_save",function(e){e.preventDefault(),!1===_.prop("disabled")&&(_.blur(),_.prop("disabled",!0));var i=s.find(".settings_field").serialize(),a={action:"tribe-ticket-save-settings",formdata:i,post_ID:d.val(),nonce:TribeTickets.add_ticket_nonce};t.post(ajaxurl,a,function(e){n.trigger("saved-image.tribe",e),e.success&&D("settings")},"json")}).on("click",".ticket_form_toggle",function(e){e.preventDefault();var a=h(),c=E();n.trigger("clear.tribe").trigger("focus.tribe"),"rsvp_form_toggle"===t(this).closest("button").attr("id")?I(!0):(I(),t(document.getElementById(a+"_global")).prop("checked",!0),t(document.getElementById(a+"_global_capacity")).val(c),t(document.getElementById(a+"_global_stock_cap")).attr("placeholder",c)),l.find(".tribe-dependency").trigger("verify.dependency"),y.prop("checked",!0),t(document.getElementById("ticket_sale_price")).closest(".input_block").hide(),"ticket_form_toggle"===t(this).attr("id")&&i!==c&&0<c&&t(document.getElementById(a+"_global_capacity")).prop("disabled",!0),t(p,u,k,b).trigger("change"),w(e,l)}).on("click","#ticket_form_cancel",function(e){D(),n.trigger("clear.tribe").trigger("focus.tribe")}).on("blur",'[name="global_stock_cap"]',function(e){var i=t(this),a=i.closest("fieldset").find('[name="ticket_global_stock"]'),n="global";0<i.val()&&(n="capped"),a.val(n)}).on("blur",'[name="ticket_global_stock"][value="own"]',function(e){var a=t(this),n=a.closest(".input_block").find('[name="ticket_stock"]');(i===n.val()||""===n.val()||0<n.val())&&n.val("0")}).on("blur",'[name="ticket_stock"]',function(e){var a=t(this);(i===a.val()||""===a.val()||0<a.val())&&a.val("0")}).on("click",'[name="ticket_form_save"]',function(e){var i=t(document.getElementById("ticket_form_table"));i.find(".ticket_provider:checked").val();n.trigger("save-ticket.tribe",e).trigger("spin.tribe","start");var a=i.find(".ticket_field").serialize(),c={action:"tribe-ticket-add-"+t("input[name=ticket_provider]:checked").val(),formdata:a,post_ID:d.val(),nonce:TribeTickets.add_ticket_nonce};t.post(ajaxurl,c,function(e){n.trigger("saved-ticket.tribe",e),e.success&&D("ticket")},"json").complete(function(){n.trigger("spin.tribe","stop").trigger("focus.tribe")})}).on("click",".ticket_delete",function(e){if(!confirm(tribe_ticket_notices.confirm_alert))return!1;e.preventDefault(),n.trigger("delete-ticket.tribe",e).trigger("spin.tribe","start");var i=t(this).attr("attr-ticket-id"),a={action:"tribe-ticket-delete-"+t(this).attr("attr-provider"),post_ID:d.val(),ticket_id:i,nonce:TribeTickets.remove_ticket_nonce};t.post(ajaxurl,a,function(a){if(n.trigger("deleted-ticket.tribe",a),a.success){var c=t(document.getElementById("tribe_ticket_list_table")).find('[data-ticket-order-id="order_'+i+'"]');c.remove(),D("delete"),w(e)}},"json").complete(function(){n.trigger("spin.tribe","stop")})}).on("click",".ticket_edit_button",function(e){e.preventDefault(),n.trigger("spin.tribe","start");var a=this.getAttribute("data-ticket-id"),c={action:"tribe-ticket-edit-"+this.getAttribute("data-provider"),post_ID:d.val(),ticket_id:a,nonce:TribeTickets.edit_ticket_nonce};t.post(ajaxurl,c,function(e){if(e){var a,c,d,o,r=e.data.price,s=r,_=!1,g=e.data.provider_class;if(t("input:radio[name=ticket_provider]").filter("[value="+e.data.provider_class+"]").click(),t("input[name=ticket_provider]:radio").change(),e.data.global_stock_mode)switch(e.data.global_stock_mode){case"global":case"capped":t(document.getElementById(g+"_global")).prop("checked",!0),t(document.getElementById(g+"_global_capacity")).val(e.data.total_global_stock).prop("disabled",!0),t(document.getElementById(g+"_global_stock_cap")).attr("placeholder",e.data.total_global_stock),i!==e.data.global_stock_cap&&t.isNumeric(e.data.global_stock_cap)&&0<e.data.global_stock_cap?(t(document.getElementById(g+"_global")).val("capped"),t(document.getElementById(g+"_global_stock_cap")).val(e.data.global_stock_cap)):(t(document.getElementById(g+"_global")).val("global"),t(document.getElementById(g+"_global_stock_cap")).val(""));break;case"own":t(document.getElementById(g+"_own")).prop("checked",!0),t(document.getElementById(g+"_capacity")).val(e.data.stock);break;default:t(document.getElementById(g+"_unlimited")).prop("checked",!0),t(document.getElementById(g+"_global_stock_cap")).val("")}else t(document.getElementById(e.data.provider_class+"_unlimited")).prop("checked",!0),t(document.querySelectorAll(".ticket_stock")).val(e.data.original_stock);t("input[name=ticket_global_stock]:radio").change(),t(document.getElementById("ticket_id")).val(e.data.ID),t(document.getElementById("ticket_name")).val(e.data.name),t(document.getElementById("ticket_description")).val(e.data.description),0===parseInt(e.data.show_description)?y.prop("checked",!0):y.removeAttr("checked"),e.data.start_date?(a=e.data.start_date,c=e.data.start_time):(a=t(document.getElementById("EventStartDate")).val(),c=t(document.getElementById("EventStartTime")).val()),p.val(a).trigger("change"),k.val(c).trigger("change"),e.data.end_date?(d=e.data.end_date,o=e.data.end_time):(d=t(document.getElementById("EventEndDate")).val(),o=t(document.getElementById("EventEndTime")).val()),u.val(d).trigger("change"),b.val(o).trigger("change"),t(document.getElementById("advanced_fields")).empty("").append(e.data.advanced_fields),"undefined"!=typeof e.data.on_sale&&e.data.on_sale&&(_=!0,r=e.data.regular_price);var m=n.find("#ticket_price");m.val(r),"undefined"!=typeof e.data.disallow_update_price_message?m.siblings(".no-update-message").html(e.data.disallow_update_price_message):m.siblings(".no-update-message").html(""),"undefined"==typeof e.data.can_update_price||e.data.can_update_price?(m.removeProp("disabled"),m.siblings(".description").show(),m.siblings(".no-update-message").hide()):(m.prop("disabled","disabled"),m.siblings(".description").hide(),m.siblings(".no-update-message").show());var v=t(document.getElementById("ticket_sale_price")),f=v.closest(".input_block");_?(v.prop("readonly",!1).val(s).prop("readonly",!0),f.show()):f.hide(),"undefined"!=typeof e.data.purchase_limit&&e.data.purchase_limit&&t(document.getElementById("ticket_purchase_limit")).val(e.data.purchase_limit),e.data.sku&&t(document.querySelectorAll(".sku_input")).val(e.data.sku),"undefined"!=typeof e.data.controls&&e.data.controls&&t(document.getElementById("ticket_bottom_right")).html(e.data.controls),n.find(".tribe-bumpdown-trigger").bumpdown(),t("a#ticket_form_toggle").hide(),l.find(".tribe-dependency").trigger("verify.dependency")}},"json").always(function(i){n.trigger("spin.tribe","stop").trigger("focus.tribe").trigger("edit-tickets-complete.tribe"),l.find(".tribe-dependency").trigger("verify.dependency"),i.data.total_global_stock&&t(document.getElementById(i.data.provider_class+"_global_capacity")).prop("disabled",!0),w(e,l)})}).on("keyup","#ticket_price",function(e){e.preventDefault();var i=price_format.decimal,a=new RegExp("[^-0-9%\\"+i+"]+","gi"),n=t(this).val(),c=n.replace(a,"");n!==c&&t(this).val(c)}).on("click","#tribe_ticket_header_image, #tribe_ticket_header_preview",function(e){e.preventDefault(),ticketHeaderImage.uploader("","")}).on("click","#global_capacity_edit_button",function(e){e.preventDefault(),t(document.getElementById("settings_global_capacity_edit")).prop("disabled",!1).focus()}).on("blur","#settings_global_capacity_edit",function(){var e=t(this).val(),i={action:"tribe-events-edit-global-capacity",post_ID:d.val(),capacity:e,nonce:TribeTickets.edit_ticket_nonce};t.post(ajaxurl,i,function(e){t(document.getElementById("settings_global_capacity_edit")).prop("disabled",!0),D(null,!1)})}).on("blur","[name=tribe-tickets-global-stock]",function(){n.trigger("tribe_tickets_global_capacity_setting_changed",t(this).attr("id"))}).on("change","#tribe-tickets-global-stock-level",function(){n.trigger("tribe_tickets_global_capacity_setting_changed",t(this).attr("id"))}).on("tribe_tickets_global_capacity_setting_changed",function(e,a){if(i!==a){var n=t(document.getElementById(a)).val();i!==n&&(t('[name="global_stock_cap"]').attr("placeholder",n),g=!0)}}).on("click","#tribe_ticket_header_remove",function(e){e.preventDefault(),t(document.getElementById("tribe_ticket_header_preview")).html(""),t(document.getElementById("tribe_ticket_header_remove")).hide(),t(document.getElementById("tribe_tickets_image_preview_filename")).hide().find(".filename").text(""),t(document.getElementById("tribe_ticket_header_image_id")).val("")}),t('input[type="submit"]').click(function(){g=!1}),t(e).on("beforeunload",function(){if(g)return tribe_global_stock_admin_ui.nav_away_msg}),f.find("img").length){t(document.getElementById("tribe_ticket_header_remove")).show();var C=f.find("img");C.removeAttr("width").removeAttr("height"),n.width()<C.width()&&C.css("width","95%")}})}(window,jQuery);