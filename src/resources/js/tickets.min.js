var ticketHeaderImage=window.ticketHeaderImage||{};!function(e,t,a){"use strict";function i(e){return"undefined"==typeof e&&(e=""),S="undefined"!=typeof tribe_dynamic_help_text.datepicker_format?tribe_datepicker_opts.dateFormat.toUpperCase().replace("YY","YYYY"):"YYYY-MM-DD",moment(new Date(e)).format(S)}function n(e){return"undefined"==typeof e&&(e=""),moment(e,j).format(j)}function d(){var e=t("input[name=default_ticket_provider]","#tribe_panel_settings").filter(":checked");return e.length>0?e.val():"Tribe__Tickets__RSVP"}function c(e){e="undefined"!=typeof e;var a=t('input[name="default_ticket_provider"]',"#tribe_panel_settings").filter(":checked"),i="Tribe__Tickets__RSVP_radio";!e&&a.length>0&&(i=a.val()+"_radio"),t(document.getElementById(i)).prop("checked",!0).trigger("change")}function r(){var e=g.find(".ticket_advanced.history");e.length&&e.on("click",".toggle-history",function(t){t.preventDefault(),e.hasClass("_show")?e.removeClass("_show"):e.addClass("_show")})}function o(){var e=t(document.getElementById("settings_global_capacity_edit"));return 0<e.length&&0<e.val()?e.val():0}function l(a,i){a&&a.preventDefault(),"undefined"==typeof i&&(i=b),f.each(function(){t(this).attr("aria-hidden",!0)}),i.attr("aria-hidden",!1),i.is(b)?t(e).off("beforeunload.tribe"):t(e).on("beforeunload.tribe",H)}function s(e,a){a="undefined"==typeof a;var i={action:"tribe-ticket-refresh-panels",notice:e,post_ID:u.val(),ticket_order:t(document.getElementById("tribe_tickets_order")).val(),nonce:TribeTickets.add_ticket_nonce};"settings-cancel"===e&&(i.action="tribe-ticket-refresh-settings"),t.post(ajaxurl,i,function(e){if(e.data.ticket_table&&""!=e.data.ticket_table){var a=t(document.getElementById("ticket_list_wrapper"));if(0===a.length){var i=t(".tribe_sectionheader.ticket_list_container");a=t("<div>",{id:"ticket_list_wrapper"}),i.append(a),i.hasClass("tribe_no_capacity")&&i.removeClass("tribe_no_capacity")}a.empty();var n=t("<div>");n.html(e.data.ticket_table),a.append(n)}if("undefined"!=typeof e.data.capacity_table&&t(document.getElementById("tribe_expanded_capacity_table")).replaceWith(e.data.capacity_table),"undefined"!=typeof e.data.settings_panel){var d=t(e.data.settings_panel);h.replaceWith(d),h=d}if("undefined"!=typeof e.data.total_capacity){var r=t(document.getElementById("ticket_form_total_capacity"));if(0<r.length)r.replaceWith(e.data.total_capacity);else{var o=t('<div class="ticket_table_intro">');o.append(e.data.total_capacity),t(".ticket_list_container").removeClass("tribe_no_capacity").prepend(o)}}c()}).complete(function(e){g.trigger("tribe-tickets-refresh-tables",e.data),a&&l()})}var _=t("html, body"),m=t(document),g=t(document.getElementById("tribetickets")),p=t(document.getElementById("event_tickets")),u=t(document.getElementById("post_ID")),k=g.find(".tribe-tickets-editor-blocker"),v=g.find(".spinner"),f=t(document.getElementById("event_tickets")).find(".ticket_panel"),b=t(document.getElementById("tribe_panel_base")),y=t(document.getElementById("tribe_panel_edit")),h=t(document.getElementById("tribe_panel_settings")),E=!1,I=t(document.getElementById("tribe-event-datepickers")),B=t(document.getElementById("ticket_start_date")),w=t(document.getElementById("ticket_end_date")),D=t(document.getElementById("ticket_start_time")),T=t(document.getElementById("ticket_end_time")),x=0,C=t(document.getElementById("tribe_ticket_header_preview")),Y=t(document.getElementById("tribe_tickets_show_description")),S="YYYY-MM-DD",j="HH:mmA",H=function(e){var t=!1;return g.find(".ticket_panel").filter('[aria-hidden="false"]').is(b)&&(t=tribe_global_stock_admin_ui.nav_away_msg),e.returnValue=t,t};ticketHeaderImage={uploader:function(){var e=wp.media({title:HeaderImageData.title,multiple:!1,library:{type:"image"},button:{text:HeaderImageData.button}});return e.on("close",function(){var t=e.state().get("selection").toJSON();t.length&&ticketHeaderImage.render(t[0])}),e.open(),!1},render:function(e){C.html(ticketHeaderImage.imgHTML(e)),t(document.getElementById("tribe_ticket_header_image_id")).val(e.id),t(document.getElementById("tribe_ticket_header_remove")).show(),t(document.getElementById("tribe_tickets_image_preview_filename")).show().find(".filename").text(e.filename)},imgHTML:function(e){var t='<img src="'+e.url+'" ';return t+='width="'+e.width+'" ',t+='height="'+e.height+'" ',t+="/>"}},m.ajaxSend(function(e,a,i){"string"===t.type(i.data)&&-1!==i.data.indexOf("action=tribe-ticket")&&g.trigger("spin.tribe","start")}),m.ajaxComplete(function(e,a,i){"string"===t.type(i.data)&&-1!==i.data.indexOf("action=tribe-ticket")&&g.trigger("spin.tribe","stop")}),m.on({"spin.tribe":function(e,a){("undefined"==typeof a||t.inArray(a,["start","stop"]))&&(a="stop"),"stop"===a?(k.hide(),v.removeClass("is-active")):(k.show(),v.addClass("is-active"))},"clear.tribe":function(){var e=y.find('input:not(:button):not(:radio):not(:checkbox):not([type="hidden"]), textarea'),a=y.find("input:checkbox, input:radio"),i=y.find("#ticket_id");y.find("input[data-default-value]").each(function(){var e=t(this);e.val(e.data("default-value"))}),B.datepicker("option","maxDate",null),B.val(t.datepicker.formatDate(S,new Date)),B.trigger("change");var n=new Intl.DateTimeFormat("en-US",{hour:"numeric",minute:"numeric"}).format(new Date);D.val(n),D.trigger("change"),w.datepicker("option","minDate",null).val(t(document.getElementById("EventStartDate")).val()).trigger("change"),T.val(t(document.getElementById("EventEndTime")).val()).trigger("change"),y.find("#ticket_price").removeProp("disabled").siblings(".no-update-message").html("").hide().end().siblings(".description").show(),t(document.getElementById("tribe-tickets-attendee-sortables")).empty(),t(".accordion-content.is-active").removeClass("is-active"),t(document.getElementById("ticket_bottom_right")).empty(),y.find(".accordion-header, .accordion-content").removeClass("is-active"),e.val("").trigger("change"),a.prop("checked",!1).trigger("change"),i.val("").trigger("change"),y.find(".tribe-tickets-editor-history-container").remove()},"focus.tribe":function(){_.animate({scrollTop:p.offset().top-50},500)},"edit-tickets-complete.tribe":function(){r()}}),m.on("click","#settings_form_toggle",function(e){l(e,h)}),m.on("click","#tribe_settings_form_cancel",function(e){s("settings-cancel")}),m.on("click","#tribe_settings_form_save",function(e){e.preventDefault();var a=t(document.getElementById("settings_global_capacity_edit"));!1===a.prop("disabled")&&(a.blur(),a.prop("disabled",!0));var i=h.find(".settings_field").serialize(),n={action:"tribe-ticket-save-settings",formdata:i,post_ID:u.val(),nonce:TribeTickets.add_ticket_nonce};t.post(ajaxurl,n,function(e){g.trigger("saved-image.tribe",e),e.success&&s("settings")},"json")}),m.on("click",".ticket_form_toggle",function(e){e.preventDefault();var r,s,_,m,p=d(),u=o();g.trigger("clear.tribe").trigger("focus.tribe"),"rsvp_form_toggle"===t(this).closest("button").attr("id")?c(!0):(c(),t(document.getElementById(p+"_"+tribe_ticket_vars.stock_mode)).prop("checked",!0),t(document.getElementById(p+"_global_capacity")).val(u),0!==u&&""!==u?t(document.getElementById(p+"_global_stock_block")).find(".global_capacity-wrapper").addClass("screen-reader-text"):t(document.getElementById(p+"_global_stock_block")).find(".global_capacity-wrapper").removeClass("screen-reader-text"),t(document.getElementById(p+"_global_stock_cap")).attr("placeholder",u)),y.find(".tribe-dependency").trigger("verify.dependency"),Y.prop("checked",!0),t(document.getElementById("ticket_sale_price")).closest(".input_block").hide(),"ticket_form_toggle"===t(this).attr("id")&&0<u&&t(document.getElementById(p+"_global_capacity")).prop("disabled",!0);var k=new Date;r=i(a!==t(document.getElementById("EventStartDate")).val()?new Date(t(document.getElementById("EventStartDate")).val()):k),B.val(r).trigger("change"),s=n(a!==t(document.getElementById("EventStartTime")).val()?t(document.getElementById("EventStartTime")).val():k),D.val(s).trigger("change"),_=a!==t(document.getElementById("EventEndDate")).val()?i(new Date(t(document.getElementById("EventEndDate")).val())):"",w.val(_).trigger("change"),m=a!==t(document.getElementById("EventEndTime")).val()?n(t(document.getElementById("EventEndTime")).val()):"",T.val(m).trigger("change"),t(".tribe-tickets-attendee-saved-fields").show(),l(e,y)}),m.on("click","#ticket_form_cancel",function(e){s(),g.trigger("clear.tribe"),g.trigger("focus.tribe")}),m.on("blur",'[name="global_stock_cap"]',function(e){var a=t(this),i=a.closest("fieldset").find('[name="ticket_global_stock"]'),n="global";0<a.val()&&(n="capped"),i.val(n)}),m.on("blur",'[name="ticket_global_stock"][value="own"]',function(e){var i=t(this),n=i.closest(".input_block").find('[name="ticket_stock"]');(a===n.val()||""===n.val()||0<n.val())&&n.val("0")}),m.on("blur",'.global_capacity-wrapper input[name="ticket_stock"]',function(e){var i=t(this);(a===i.val()||""===i.val()||0>i.val())&&i.val("0")}),m.on("click.tribe",'[name="ticket_form_save"]',function(e){var a=t(document.getElementById("ticket_form_table"));if(a.trigger("validation.tribe"),!tribe.validation.hasErrors(a)){g.trigger("save-ticket.tribe",e);var i={action:"tribe-ticket-add-"+t("input[name=ticket_provider]:checked").val(),formdata:a.find(".ticket_field").serialize(),post_ID:u.val(),nonce:TribeTickets.add_ticket_nonce};t.post(ajaxurl,i,function(e){g.trigger("saved-ticket.tribe",e),e.success&&s("ticket")},"json").complete(function(){g.trigger("focus.tribe")})}}),m.on("click",".ticket_delete",function(e){if(!confirm(tribe_ticket_notices.confirm_alert))return!1;e.preventDefault(),g.trigger("delete-ticket.tribe",e);var a=t(this).attr("attr-ticket-id"),i={action:"tribe-ticket-delete-"+t(this).attr("attr-provider"),post_ID:u.val(),ticket_id:a,nonce:TribeTickets.remove_ticket_nonce};t.post(ajaxurl,i,function(i){if(g.trigger("deleted-ticket.tribe",i),i.success){var n=t(document.getElementById("tribe_ticket_list_table")).find('[data-ticket-order-id="order_'+a+'"]');n.remove(),s("delete"),l(e)}},"json")}),m.on("click",".ticket_edit_button",function(d){d.preventDefault();var c=this.getAttribute("data-ticket-id"),r={action:"tribe-ticket-edit-"+this.getAttribute("data-provider"),post_ID:u.val(),ticket_id:c,nonce:TribeTickets.edit_ticket_nonce};t.post(ajaxurl,r,function(d){if(d){var c,r,o,l,s=d.data.price,_=s,m=!1,p=d.data.provider_class;if(t("input:radio[name=ticket_provider]").filter("[value="+d.data.provider_class+"]").click(),t("input[name=ticket_provider]:radio").change(),d.data.global_stock_mode)switch(d.data.global_stock_mode){case"global":t(document.getElementById(p+"_global")).prop("checked",!0).val("global"),t(document.getElementById(p+"_global_capacity")).val(d.data.total_global_stock).prop("disabled",!0),t(document.getElementById(p+"_global_stock_cap")).attr("placeholder",d.data.total_global_stock),t(document.getElementById(p+"_global_stock_cap")).val("");break;case"capped":t(document.getElementById(p+"_global")).prop("checked",!0).val("capped"),t(document.getElementById(p+"_global_capacity")).val(d.data.total_global_stock).prop("disabled",!0),t(document.getElementById(p+"_global_stock_cap")).attr("placeholder",d.data.total_global_stock),a!==d.data.global_stock_cap&&t.isNumeric(d.data.global_stock_cap)&&0<d.data.global_stock_cap?t(document.getElementById(p+"_global_stock_cap")).val(d.data.global_stock_cap):t(document.getElementById(p+"_global_stock_cap")).val(0);break;case"own":t(document.getElementById(p+"_own")).prop("checked",!0),t(document.getElementById(p+"_capacity")).val(d.data.stock);break;default:t(document.getElementById(p+"_unlimited")).prop("checked",!0),t(document.getElementById(p+"_global_stock_cap")).val("")}else t(document.getElementById(d.data.provider_class+"_unlimited")).prop("checked",!0),t(document.querySelectorAll(".ticket_stock")).val(d.data.original_stock);t("input[name=ticket_global_stock]:radio").change(),t(document.getElementById("ticket_id")).val(d.data.ID),t(document.getElementById("ticket_name")).val(d.data.name),t(document.getElementById("ticket_description")).val(d.data.description),0===parseInt(d.data.show_description)?Y.prop("checked",!0):Y.removeAttr("checked");var u=Date.now();c=i(d.data.start_date?d.data.start_date:a!==t(document.getElementById("EventStartDate")).val()?t(document.getElementById("EventStartDate")).val():u),r=n(d.data.start_time?d.data.start_time:a!==t(document.getElementById("EventStartTime")).val()?t(document.getElementById("EventStartTime")).val():u),B.val(c).trigger("change"),D.val(r).trigger("change"),o=d.data.end_date?i(d.data.end_date):a!==t(document.getElementById("EventEndDate")).val()?i(t(document.getElementById("EventEndDate")).val()):"",l=d.data.end_time?n(d.data.end_time):a!==t(document.getElementById("EventEndTime")).val()?n(t(document.getElementById("EventEndTime")).val()):"",w.val(o).trigger("change"),T.val(l).trigger("change"),t(document.getElementById("advanced_fields")).empty("").append(d.data.advanced_fields),"undefined"!=typeof d.data.on_sale&&d.data.on_sale&&(m=!0,s=d.data.regular_price);var k=g.find("#ticket_price");if(k.val(s),"undefined"!=typeof d.data.disallow_update_price_message?k.siblings(".no-update-message").html(d.data.disallow_update_price_message):k.siblings(".no-update-message").html(""),"undefined"==typeof d.data.can_update_price||d.data.can_update_price?(k.removeProp("disabled"),k.siblings(".description").show(),k.siblings(".no-update-message").hide()):(k.prop("disabled","disabled"),k.siblings(".description").hide(),k.siblings(".no-update-message").show()),"undefined"!=typeof d.data.history){var v=t(d.data.history);y.find(".accordion").append(v),e.MTAccordion({target:".accordion"})}else y.find(".tribe-tickets-editor-history-container").remove();var f=t(document.getElementById("ticket_sale_price")),b=f.closest(".input_block");m?(f.prop("readonly",!1).val(_).prop("readonly",!0),b.show()):b.hide(),"undefined"!=typeof d.data.purchase_limit&&d.data.purchase_limit&&t(document.getElementById("ticket_purchase_limit")).val(d.data.purchase_limit),d.data.sku&&t(document.querySelectorAll(".sku_input")).val(d.data.sku),t(document.getElementById("tribe-tickets-attendee-sortables")).empty(),"undefined"!=typeof d.data.attendee_fields&&d.data.attendee_fields?(t(document.getElementById("tribe-tickets-attendee-sortables")).html(d.data.attendee_fields),t(".tribe-tickets-attendee-saved-fields").hide()):t(".tribe-tickets-attendee-saved-fields").show(),"undefined"!=typeof d.data.controls&&d.data.controls&&t(document.getElementById("ticket_bottom_right")).html(d.data.controls),g.find(".tribe-bumpdown-trigger").bumpdown(),t("a#ticket_form_toggle").hide(),y.find(".tribe-dependency").trigger("verify.dependency")}},"json").always(function(e){g.trigger("focus.tribe").trigger("edit-tickets-complete.tribe"),y.find(".tribe-dependency").trigger("verify.dependency"),e.data.total_global_stock&&t(document.getElementById(e.data.provider_class+"_global_capacity")).prop("disabled",!0),l(d,y)})}),m.on("keyup","#ticket_price",function(e){e.preventDefault();var a=price_format.decimal,i=new RegExp("[^-0-9%\\"+a+"]+","gi"),n=t(this).val(),d=n.replace(i,"");n!==d&&t(this).val(d)}),m.on("click","#tribe_ticket_header_image, #tribe_ticket_header_preview",function(e){e.preventDefault(),ticketHeaderImage.uploader("","")}),m.on("click","#global_capacity_edit_button",function(e){e.preventDefault(),t(document.getElementById("settings_global_capacity_edit")).prop("disabled",!1).focus()}),m.on("blur","#settings_global_capacity_edit",function(){var e=t(this),a=e.val();""===a&&(e.val(0),a=0);var i={action:"tribe-events-edit-global-capacity",post_ID:u.val(),capacity:a,nonce:TribeTickets.edit_ticket_nonce};t.post(ajaxurl,i,function(e){t(document.getElementById("settings_global_capacity_edit")).prop("disabled",!0),s(null,!1)})}),m.on("blur","[name=tribe-tickets-global-stock]",function(){g.trigger("tribe_tickets_global_capacity_setting_changed",t(this).attr("id"))}),m.on("change","#tribe-tickets-global-stock-level",function(){g.trigger("tribe_tickets_global_capacity_setting_changed",t(this).attr("id"))}),m.on("tribe_tickets_global_capacity_setting_changed",function(e,i){if(a!==i){var n=t(document.getElementById(i)).val();a!==n&&(t('[name="global_stock_cap"]').attr("placeholder",n),E=!0)}}),m.on("click","#tribe_ticket_header_remove",function(e){e.preventDefault(),t(document.getElementById("tribe_ticket_header_preview")).html(""),t(document.getElementById("tribe_ticket_header_remove")).hide(),t(document.getElementById("tribe_tickets_image_preview_filename")).hide().find(".filename").text(""),t(document.getElementById("tribe_ticket_header_image_id")).val("")}),m.ready(function(){I.length&&(x=I.data("startofweek"));var e={dateFormat:S,showAnim:"fadeIn",changeMonth:!0,changeYear:!0,numberOfMonths:3,firstDay:x,showButtonPanel:!1,onChange:function(){},onSelect:function(e,a){var i=t.datepicker.parseDate("yy-mm-dd",e);"ticket_start_date"===a.id?w.datepicker("option","minDate",i):B.datepicker("option","maxDate",i)}};t.extend(e,tribe_l10n_datatables.datepicker),S=a!==tribe_dynamic_help_text.datepicker_format?tribe_dynamic_help_text.datepicker_format:"YYYY-MM-DD",e.dateFormat=S;var i=g.find(".tribe-timepicker:not(.ui-timepicker-input)");if(tribe_timepickers.setup_timepickers(i),B.datepicker(e).datepicker("option","defaultDate",t(document.getElementById("EventStartDate")).val()).keyup(function(e){8!==e.keyCode&&46!==e.keyCode||t.datepicker._clearDate(this)}),w.datepicker(e).datepicker("option","defaultDate",t(document.getElementById("EventEndDate")).val()).keyup(function(e){8!==e.keyCode&&46!==e.keyCode||t.datepicker._clearDate(this)}),C.find("img").length){t(document.getElementById("tribe_ticket_header_remove")).show();var n=C.find("img");n.removeAttr("width").removeAttr("height"),g.width()<n.width()&&n.css("width","95%")}})}(window,jQuery);