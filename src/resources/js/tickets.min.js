var ticketHeaderImage=window.ticketHeaderImage||{};!function(e,t,a){"use strict";function i(e,t){"undefined"==typeof e&&(e="");var a=D;return!0===t&&(a=w[0]),a=a.toUpperCase().replace("YY","YYYY"),moment(e,a).format(D.toUpperCase().replace("YY","YYYY"))}function n(e){return"undefined"==typeof e&&(e=""),moment(e,x).format(x)}function d(e){"undefined"==typeof e&&(e=!0);var a=s.find(".tribe-ticket-editor-field-default_provider").filter(":checked"),i="Tribe__Tickets__RSVP_radio";!e&&a.length>0&&(i=a.val()+"_radio"),t(document.getElementById(i)).prop("checked",!0).trigger("change")}function c(){var e=s.find(".ticket_advanced.history");e.length&&e.on("click",".toggle-history",function(t){t.preventDefault(),e.hasClass("_show")?e.removeClass("_show"):e.addClass("_show")})}function r(a,i){a&&a.preventDefault(),"undefined"==typeof i&&(i=g),s.find(".ticket_panel").each(function(){t(this).attr("aria-hidden",!0)}),i.attr("aria-hidden",!1),i.is(g)?t(e).off("beforeunload.tribe"):t(e).on("beforeunload.tribe",T)}function o(e,a){a="undefined"==typeof a;var i=g.find(".tribe-ticket-field-order"),n={action:"tribe-ticket-refresh-panels",notice:e,post_ID:p.val(),data:i.serialize(),nonce:TribeTickets.add_ticket_nonce};"settings-cancel"===e&&(n.action="tribe-ticket-refresh-settings"),t.post(ajaxurl,n,function(e){if(e.data.ticket_table&&""!=e.data.ticket_table){var a=t(document.getElementById("ticket_list_wrapper"));if(0===a.length){var i=t(".tribe_sectionheader.ticket_list_container");a=t("<div>",{id:"ticket_list_wrapper"}),i.append(a),i.hasClass("tribe_no_capacity")&&i.removeClass("tribe_no_capacity")}a.empty();var n=t("<div>");n.html(e.data.ticket_table),a.append(n)}if("undefined"!=typeof e.data.capacity_table&&t(document.getElementById("tribe_expanded_capacity_table")).replaceWith(e.data.capacity_table),"undefined"!=typeof e.data.settings_panel){var c=t(e.data.settings_panel);y.replaceWith(c),y=c}if("undefined"!=typeof e.data.total_capacity){var r=t(document.getElementById("ticket_form_total_capacity"));if(0<r.length)r.replaceWith(e.data.total_capacity);else{var o=t('<div class="ticket_table_intro">');o.append(e.data.total_capacity),t(".ticket_list_container").removeClass("tribe_no_capacity").prepend(o)}}d()}).complete(function(e){s.trigger("tribe-tickets-refresh-tables",e.data),a&&r()})}var l=(t("html, body"),t(document)),s=t(document.getElementById("tribetickets"));if(0!==s.length){var p=(t(document.getElementById("event_tickets")),t(document.getElementById("post_ID"))),m=t(document.getElementById("publish")),_=s.find(".tribe-tickets-editor-blocker"),u=s.find(".spinner"),g=t(document.getElementById("tribe_panel_base")),f=t(document.getElementById("tribe_panel_edit")),y=t(document.getElementById("tribe_panel_settings")),v=t(document.getElementById("tribe-event-datepickers")),k=t(document.getElementById("ticket_start_date")),b=t(document.getElementById("ticket_end_date")),h=t(document.getElementById("ticket_start_time")),I=t(document.getElementById("ticket_end_time")),E=0,B=t(document.getElementById("tribe_ticket_header_preview")),w=["yy-mm-dd","m/d/yy","mm/dd/yy","d/m/yy","dd/mm/yy","m-d-yy","mm-dd-yy","d-m-yy","dd-mm-yy","yy.mm.dd","mm.dd.yy","dd.mm.yy"],D=w[0],x="HH:mmA",C=function(e,a){if("undefined"==typeof a){var i=t(this);a=i.val()}if(void 0!==a){a||(a=0),a=parseInt(a,10);var n=t(".tribe-ticket-capacity-max"),d=n.find(".tribe-ticket-capacity-value"),c=t('.tribe-ticket-field-capacity[name="tribe-ticket[capacity]"]');c.attr("placeholder",a),a?c.attr("max",a):a=0,d.text(a)}},T=function(e){var t=!1;return"true"===g.attr("aria-hidden")&&(t=tribe_global_stock_admin_ui.nav_away_msg),e.returnValue=t,t};ticketHeaderImage={uploader:function(){var e=wp.media({title:HeaderImageData.title,multiple:!1,library:{type:"image"},button:{text:HeaderImageData.button}});return e.on("close",function(){var t=e.state().get("selection").toJSON();t.length&&ticketHeaderImage.render(t[0])}),e.open(),!1},render:function(e){B.html(ticketHeaderImage.imgHTML(e)),t(document.getElementById("tribe_ticket_header_image_id")).val(e.id),t(document.getElementById("tribe_ticket_header_remove")).show(),t(document.getElementById("tribe_tickets_image_preview_filename")).show().find(".filename").text(e.filename)},imgHTML:function(e){var t='<img src="'+e.url+'" ';return t+='width="'+e.width+'" ',t+='height="'+e.height+'" ',t+="/>"}},a.panels={list:"#tribe_panel_base",ticket:"#tribe_panel_edit",settings:"#tribe_panel_settings"},a.fetch_panels=function(e,i){e&&e.preventDefault(),"undefined"==typeof i&&(i=[]);var n={action:"tribe-ticket-panels",notice:!1,post_id:p.val(),nonce:TribeTickets.add_ticket_nonce,data:i,is_admin:t("body").hasClass("wp-admin")};t.post(ajaxurl,n,function(e){e.success&&a.refresh_panels(e.data)})},a.refresh_panels=function(i){g=t(i.list),f=t(i.ticket),y=t(i.settings),s.find(a.panels.list).replaceWith(g),s.find(a.panels.ticket).replaceWith(f),s.find(a.panels.settings).replaceWith(y),s.find(".tribe-dependent").dependency(),s.find(".tribe-dependency").trigger("verify.dependency"),e.MTAccordion({target:".accordion"})},l.ajaxSend(function(e,a,i){"string"===t.type(i.data)&&-1!==i.data.indexOf("action=tribe-ticket")&&s.trigger("spin.tribe","start")}),l.ajaxComplete(function(e,a,i){"string"===t.type(i.data)&&-1!==i.data.indexOf("action=tribe-ticket")&&s.trigger("spin.tribe","stop")}),l.on({"spin.tribe":function(e,a){("undefined"==typeof a||t.inArray(a,["start","stop"]))&&(a="stop"),"stop"===a?(_.hide(),u.removeClass("is-active")):(_.show(),u.addClass("is-active"))},"clear.tribe":function(){var e=f.find('input:not(:button):not(:radio):not(:checkbox):not([type="hidden"]), textarea'),a=f.find("input:checkbox, input:radio"),i=f.find("#ticket_id");f.find("input[data-default-value]").each(function(){var e=t(this);e.val(e.data("default-value"))}),k.datepicker("option","maxDate",null),k.val(""),k.trigger("change"),h.val(""),h.trigger("change"),b.datepicker("option","minDate",null),b.val(""),b.trigger("change"),I.val(""),I.trigger("change"),f.find("#ticket_price").removeProp("disabled").siblings(".no-update-message").html("").hide().end().siblings(".description").show(),t(document.getElementById("tribe-tickets-attendee-sortables")).empty(),t(".accordion-content.is-active").removeClass("is-active"),t(document.getElementById("ticket_bottom_right")).empty(),f.find(".accordion-header, .accordion-content").removeClass("is-active"),e.val("").trigger("change"),a.prop("checked",!1).trigger("change"),i.val("").trigger("change"),f.find(".tribe-tickets-editor-history-container").remove()},"edit-tickets-complete.tribe":function(){c()}}),l.on("click","#settings_form_toggle",function(e){r(e,y)}),l.on("click","#tribe_settings_form_cancel",a.fetch_panels),l.on("click","#ticket_form_cancel",a.fetch_panels),l.on("click","#tribe_settings_form_save",function(e){e.preventDefault();var t=y.find("input,textarea").serialize();a.fetch_panels(null,t)}),l.on("click",".ticket_delete",function(e){if(!confirm(tribe_ticket_notices.confirm_alert))return!1;e.preventDefault(),s.trigger("delete-ticket.tribe",e);var a=t(this).attr("attr-ticket-id"),i={action:"tribe-ticket-delete-"+t(this).attr("attr-provider"),post_ID:p.val(),ticket_id:a,nonce:TribeTickets.remove_ticket_nonce};t.post(ajaxurl,i,function(i){if(s.trigger("deleted-ticket.tribe",i),i.success){var n=t(document.getElementById("tribe_ticket_list_table")).find('[data-ticket-order-id="order_'+a+'"]');n.remove(),o("delete"),r(e)}},"json")}),l.on("click",".ticket_form_toggle",function(e){e.preventDefault();var a=t(this);d("rsvp_form_toggle"===a.attr("id")),f.find(".tribe-dependency").trigger("verify.dependency"),f.find(".tribe-ticket-field-event-capacity").prop("disabled",!0),r(e,f)}),l.on("click",".ticket_edit_button",function(a){a.preventDefault();var d=this.getAttribute("data-ticket-id"),c={action:"tribe-ticket-edit-"+this.getAttribute("data-provider"),post_ID:p.val(),ticket_id:d,nonce:TribeTickets.edit_ticket_nonce,is_admin:t("body").hasClass("wp-admin")};t.post(ajaxurl,c,function(d){if(d){var c,r,o,l,p=d.data.price,m=p,_=!1,u=d.data.provider_class,g=t(".tribe-ticket-capacity-max");g.find(".tribe-ticket-capacity-value");if(t("input:radio[name=ticket_provider]").filter("[value="+d.data.provider_class+"]").click(),t("input[name=ticket_provider]:radio").change(),d.data.global_stock_mode)switch(d.data.global_stock_mode){case"global":t(document.getElementById(u+"_global")).prop("checked",!0).val("global"),t(document.getElementById(u+"_global_capacity")).attr("placeholder",d.data.event_capacity).val(d.data.event_capacity).prop("disabled",!0),t(document.getElementById(u+"_global_stock_cap")).val(""),C(a,d.data.event_capacity);break;case"capped":t(document.getElementById(u+"_global")).prop("checked",!0).val("capped"),t(document.getElementById(u+"_global_capacity")).attr("placeholder",d.data.event_capacity).val(d.data.event_capacity).prop("disabled",!0),t(document.getElementById(u+"_global_stock_cap")).val(d.data.capacity),C(a,d.data.event_capacity);break;case"own":t(document.getElementById(u+"_own")).prop("checked",!0),-1!=d.data.capacity&&t(document.getElementById(u+"_capacity")).val(d.data.capacity);break;default:t(document.getElementById(u+"_unlimited")).prop("checked",!0),t(document.getElementById(u+"_global_stock_cap")).val("")}else t(document.getElementById(d.data.provider_class+"_unlimited")).prop("checked",!0),t(document.querySelectorAll(".ticket_stock")).val(d.data.original_stock);t("input[name=ticket_global_stock]:radio").change(),t(document.getElementById("ticket_id")).val(d.data.ID),t(document.getElementById("ticket_name")).val(d.data.name),t(document.getElementById("ticket_description")).val(d.data.description),d.data.show_description||1===parseInt(d.data.show_description,10)?t(document.getElementById("tribe_tickets_show_description")).prop("checked",!0):t(document.getElementById("tribe_tickets_show_description")).removeAttr("checked"),d.data.start_date?c=i(d.data.start_date,!0):void 0!==t(document.getElementById("EventStartDate")).val()&&(c=i(t(document.getElementById("EventStartDate")).val())),d.data.start_time?r=n(d.data.start_time):void 0!==t(document.getElementById("EventStartTime")).val()&&(r=n(t(document.getElementById("EventStartTime")).val())),c&&k.val(c).trigger("change"),r&&h.val(r).trigger("change"),d.data.end_date?o=i(d.data.end_date,!0):void 0!==t(document.getElementById("EventEndDate")).val()&&(o=i(t(document.getElementById("EventEndDate")).val())),d.data.end_time?l=n(d.data.end_time):void 0!==t(document.getElementById("EventEndTime")).val()&&(l=n(t(document.getElementById("EventEndTime")).val())),o&&b.val(o).trigger("change"),l&&I.val(l).trigger("change"),t(document.getElementById("advanced_fields")).empty("").append(d.data.advanced_fields),"undefined"!=typeof d.data.on_sale&&d.data.on_sale&&(_=!0,p=d.data.regular_price);var y=s.find("#ticket_price");if(y.val(p),"undefined"!=typeof d.data.disallow_update_price_message?y.siblings(".no-update-message").html(d.data.disallow_update_price_message):y.siblings(".no-update-message").html(""),"undefined"==typeof d.data.can_update_price||d.data.can_update_price?(y.removeProp("disabled"),y.siblings(".description").show(),y.siblings(".no-update-message").hide()):(y.prop("disabled","disabled"),y.siblings(".description").hide(),y.siblings(".no-update-message").show()),"undefined"!=typeof d.data.history){var v=t(d.data.history);f.find(".accordion").append(v),e.MTAccordion({target:".accordion"})}else f.find(".tribe-tickets-editor-history-container").remove();var E=t(document.getElementById("ticket_sale_price")),B=E.closest(".input_block");_?(E.prop("readonly",!1).val(m).prop("readonly",!0),B.show()):B.hide(),"undefined"!=typeof d.data.purchase_limit&&d.data.purchase_limit&&t(document.getElementById("ticket_purchase_limit")).val(d.data.purchase_limit),d.data.sku&&t(document.querySelectorAll(".sku_input")).val(d.data.sku),t(document.getElementById("tribe-tickets-attendee-sortables")).empty(),"undefined"!=typeof d.data.attendee_fields&&d.data.attendee_fields?(t(document.getElementById("tribe-tickets-attendee-sortables")).html(d.data.attendee_fields),t(".tribe-tickets-attendee-saved-fields").hide()):t(".tribe-tickets-attendee-saved-fields").show(),"undefined"!=typeof d.data.controls&&d.data.controls&&t(document.getElementById("ticket_bottom_right")).html(d.data.controls),s.find(".tribe-bumpdown-trigger").bumpdown(),t("a#ticket_form_toggle").hide(),f.find(".tribe-dependency").trigger("verify.dependency")}},"json").always(function(e){s.trigger("edit-tickets-complete.tribe"),f.find(".tribe-dependency").trigger("verify.dependency"),e.data.event_capacity&&t(document.getElementById(e.data.provider_class+"_global_capacity")).prop("disabled",!0),r(a,f)})}),l.on("change",".tribe-ticket-field-capacity",function(e){var a=t(this),i=a.parents(".input_block").eq(0).find(".tribe-ticket-field-mode");a.val()&&i.val("capped")}),l.on("click.tribe",'[name="ticket_form_save"]',function(e){var i=t(document.getElementById("ticket_form_table"));if(i.trigger("validation.tribe"),!tribe.validation.hasErrors(i)){s.trigger("pre-save-ticket.tribe",e);var n=g.find(".tribe-ticket-field-order"),d={action:"tribe-ticket-add",data:f.find("input,textarea").serialize(),post_id:p.val(),nonce:TribeTickets.add_ticket_nonce,menu_order:n.length,is_admin:t("body").hasClass("wp-admin")};t.post(ajaxurl,d,function(e){e.success&&a.refresh_panels(e.data)})}}),l.on("keyup","#ticket_price",function(e){e.preventDefault();var a=price_format.decimal,i=new RegExp("[^-0-9%\\"+a+"]+","gi"),n=t(this).val(),d=n.replace(i,"");n!==d&&t(this).val(d)}),l.on("click","#tribe_ticket_header_image, #tribe_ticket_header_preview",function(e){e.preventDefault(),ticketHeaderImage.uploader("","")}),l.on("focus","#settings_global_capacity_edit",function(){var e=t(this),a=0,i=t(".tribe-tickets-editor-capacity-table").find("[data-capacity]");i.each(function(){var e=t(this);a+=parseInt(e.data("capacity"),10)}),e.data("nonSharedCapacity",a)}),l.on("blur change","#settings_global_capacity_edit",function(){var e=t(".tribe-tickets-editor-table-row-capacity-total"),a=parseInt(e.data("totalCapacity"),10);if(-1!==a){var i=t(this),n=e.find(".tribe-tickets-editor-total-capacity"),d=parseInt(i.val(),10),c=i.data("nonSharedCapacity");(""===d||0>d)&&(i.val(0),d=0);var r=c+d;n.text(r)}}),l.on("click","#global_capacity_edit_button",function(e){e.preventDefault(),t(document.getElementById("settings_global_capacity_edit")).prop("disabled",!1).focus()}),l.on("blur",'[name="tribe-ticket[event_capacity]"]',C),l.on("change",'[name="tribe-ticket[capacity]"]',function(e){var a=t(this),i=parseInt(a.attr("max"),10),n=parseInt(a.val(),10);i&&i<n&&a.val(i)}),l.on("change","#tribe-tickets-global-stock-level",C),l.on("click","#tribe_ticket_header_remove",function(e){e.preventDefault(),t(document.getElementById("tribe_ticket_header_preview")).html(""),t(document.getElementById("tribe_ticket_header_remove")).hide(),t(document.getElementById("tribe_tickets_image_preview_filename")).hide().find(".filename").text(""),t(document.getElementById("tribe_ticket_header_image_id")).val("")}),l.ready(function(){if(v.length&&(E=v.data("startofweek")),"undefined"!=typeof tribe_dynamic_help_text){var a=t.isNumeric(tribe_dynamic_help_text.datepicker_format_index)?tribe_dynamic_help_text.datepicker_format_index:0;D=w[a]}var i={dateFormat:D,showAnim:"fadeIn",changeMonth:!0,changeYear:!0,numberOfMonths:3,firstDay:E,showButtonPanel:!1,onChange:function(){},beforeShow:function(e,a){a.input.data("prevDate",a.input.datepicker("getDate"));var i=t(a.dpDiv);i.addClass("tribe-ui-datepicker"),i.attrchange({trackValues:!0,callback:function(e){(e.newValue.indexOf("display: none")>=0||e.newValue.indexOf("display:none")>=0)&&i.removeClass("tribe-ui-datepicker")}})},onSelect:function(e,a){var i=t.datepicker.parseDate(D,e);"ticket_start_date"===a.id?b.datepicker("option","minDate",i):k.datepicker("option","maxDate",i)}};t.extend(i,tribe_l10n_datatables.datepicker);var n=s.find(".tribe-timepicker:not(.ui-timepicker-input)");if(tribe_timepickers.setup_timepickers(n),k.datepicker(i).datepicker("option","defaultDate",t(document.getElementById("EventStartDate")).val()).keyup(function(e){8!==e.keyCode&&46!==e.keyCode||t.datepicker._clearDate(this)}),b.datepicker(i).datepicker("option","defaultDate",t(document.getElementById("EventEndDate")).val()).keyup(function(e){8!==e.keyCode&&46!==e.keyCode||t.datepicker._clearDate(this)}),B.find("img").length){t(document.getElementById("tribe_ticket_header_remove")).show();var d=B.find("img");d.removeAttr("width").removeAttr("height"),s.width()<d.width()&&d.css("width","95%")}m.on("click.tribe-ticket-editing-in-progress",function(a){return!("true"===g.attr("aria-hidden")&&!confirm(g.data("save-prompt")))&&void t(e).off("beforeunload.tribe")})})}}(window,jQuery,{});